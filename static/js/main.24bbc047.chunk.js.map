{"version":3,"sources":["widgets/Header.module.css","emulator/Screen.js","emulator/FrameTimer.js","emulator/Speakers.js","emulator/controllers/Controller.js","emulator/controllers/LocalController.js","locales/index.js","locales/strings.js","emulator/index.js","emulator/Emulator.js","widgets/BalloonMessage.js","widgets/Header.js","networking/transfer/Send.js","networking/transfer/Receive.js","networking/MasterSyncer.js","networking/SlaveSyncer.js","gui/InviteHeader.js","gui/JoinHeader.js","widgets/KeyBinding.js","gui/Settings.js","gui/Overlay.js","widgets/TVNoise.js","gui/helpers/index.js","gui/helpers/cleanQueryString.js","gui/helpers/ellipsize.js","widgets/Controls.js","widgets/SettingsButton.js","gui/PlayScreen.js","App.js","index.js","widgets/Controls.module.css","gui/PlayScreen.module.css","gui/Overlay.module.css","gui/Settings.module.css","widgets/BalloonMessage.module.css","events/bus.js","events/index.js","emulator/Screen.module.css","assets/halu.svg","widgets/SettingsButton.module.css","config.js"],"names":["module","exports","header","small","message","title","titleLogo","titleText","link","Screen","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","setBuffer","bind","assertThisInitialized","writeBuffer","_this2","react_default","a","createElement","className","styles","screen","width","height","ref","canvas","_initCanvas","buffer","y","x","i","buf32","imageData","data","set","buf8","context","putImageData","getContext","getImageData","fillStyle","fillRect","buf","ArrayBuffer","length","Uint8ClampedArray","Uint32Array","Component","FPS","FrameTimer","onFrame","fps","arguments","undefined","_run","_isRunning","_frameId","requestAnimationFrame","now","Date","elapsedTime","_lastTime","_interval","_fps","_startTime","cancelAnimationFrame","BUFFER_SIZE","Speakers","bufferSize","RingBuffer","writeSample","_onAudioProcess","audioCtx","window","AudioContext","scriptNode","createScriptProcessor","onaudioprocess","gainNode","createGain","gain","value","config","sound","connect","destination","bus","on","disconnect","close","catch","console","error","removeListener","sampleRate","left","right","size","deqN","enq","event","samples","outputBuffer","getChannelData","e","BITS","Controller","player","getNes","buttons","BUTTON_A","BUTTON_B","BUTTON_SELECT","BUTTON_START","BUTTON_UP","BUTTON_DOWN","BUTTON_LEFT","BUTTON_RIGHT","byte","sync","button","isPressed","nes","buttonDown","jsnes","buttonUp","source","LocalController","onStart","_processGamepadIfPossible","gamepad","_","first","navigator","getGamepads","mapping","id","pressed","_setButton","_onKeyDown","keyMap","key","_onKeyUp","immediateButtons","clone","options","input","esm_get","prototype","setInterval","addEventListener","removeEventListener","isMaster","strings","buffering","connected","connecting","controls","copied","crtEffect","dragARomHere","enabled_false","enabled_true","errors","connectionFailed","invalidRom","serverIsDown","loading","pressStart","setDefaults","settings","shareThis","toPlayWithSomeone","waiting","yourXboxController","Emulator","localController","onStartPressed","remoteController","Screen_Screen","_initialize","attach","nextProps","stop","frameTimer","start","speakers","frame","onError","detach","_this3","_this$props","rom","bytes","Buffer","from","toString","NES","onAudioSample","getSampleRate","syncer","loadROM","emulator","BalloonMessage","children","classNames","balloon","character","src","haluImage","alt","Header","state","isEmpty","BalloonMessage_BalloonMessage","href","target","rel","tabIndex","Send","channel","_sent","_total","byteLength","send","remaining","Math","min","chunk","slice","Receive","_received","_appendBuffer","buffer1","buffer2","tmp","Uint8Array","STATE","MasterSyncer","_reset","_onData","masterBufferLimit","_state","_blindFrames","emit","_runFrame","_transfer","run","initializeRom","_emulator","_buffer","shift","remoteButtons","syncAll","toByte","_start","push","EventEmitter","SlaveSyncer","_hasPressedStart","_config$buffering","minBufferSize","maxBufferSize","_isBuffering","_ifBuffering","localButtons","COPIED_MESSAGE_TIME","InviteHeader","token","isDown","_copyLink","preventDefault","clipboard","writeText","setState","setTimeout","needsRom","_this$state","Header_Header","concat","onClick","onSyncer","quickp2p","createChannel","JoinHeader","joinChannel","KeyBinding","_onAssign","isAssigning","onAssignCancel","onAssignStart","displayName","_this$props$verticalM","verticalMirror","type","style","transform","display","BUTTONS","name","Settings","mappingButton","_onClose","_onSetDefaults","reset","_notify","oldKey","findKey","it","newKey","save","closeButton","setDefaultsButton","soundOptions","map","checked","onChange","_update","bufferingOptions","crt","KeyBinding_KeyBinding","property","container","document","querySelector","classList","add","remove","forceUpdate","Overlay","isSettingsMenuOpen","isLoading","isVisible","overlay","show","loader","dark","Settings_Settings","react_loader_spinner_default","color","TVNoise","borderRadius","self","toggle","loop","ctx","w","h","idata","createImageData","buffer32","len","random","noise","helpers","cleanQueryString","url","location","replace","substring","indexOf","history","replaceState","ellipsize","string","limit","FRIENDLY_NAMES","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," ","Controls","_onGamepadConnected","usesGamepad","upKey","_keyFor","isUpArrow","centered","Fragment","controller","dpad","element","_format","toUpperCase","SettingsButton","_onClick","require","default","PlayScreen","_onSyncer","_loadRom","initializeEmulator","_onFileDrop","file","dataTransfer","files","reader","FileReader","onload","result","updateRom","readAsArrayBuffer","_ignore","stopPropagation","_onStartPressed","_onError","app","JoinHeader_JoinHeader","InviteHeader_InviteHeader","main","gameContainer","Overlay_Overlay","src_emulator","TVNoise_TVNoise","Controls_Controls","menu","SettingsButton_SettingsButton","callback","noop","setStore","SimpleStore","App","hash","startsWith","PlayScreen_PlayScreen","inviteToken","_listener","querystring","parse","search","PureComponent","ReactDOM","render","App_App","getElementById","__webpack_require__","p","Config","C_Work_nestation_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","defaultOptions","load","localStorage","setItem","JSON","stringify","getItem","find","d","Delete","Enter","__webpack_exports__"],"mappings":"4EACAA,EAAAC,QAAA,CAAkBC,OAAA,uBAAAC,MAAA,sBAAAC,QAAA,wBAAAC,MAAA,sBAAAC,UAAA,0BAAAC,UAAA,0BAAAC,KAAA,oNCMGC,cACpB,SAAAA,EAAYC,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IAClBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KAEDQ,UAAYP,EAAKO,UAAUC,KAAfP,OAAAQ,EAAA,EAAAR,QAAAQ,EAAA,EAAAR,CAAAD,KACjBA,EAAKU,YAAcV,EAAKU,YAAYF,KAAjBP,OAAAQ,EAAA,EAAAR,QAAAQ,EAAA,EAAAR,CAAAD,KAJDA,wEAOV,IAAAW,EAAAR,KACR,OACCS,EAAAC,EAAAC,cAAA,UACCC,UAAWC,IAAOC,OAClBC,MAhBiB,IAiBjBC,OAhBkB,IAiBlBC,IAAK,SAACC,GACDA,GAAQV,EAAKW,YAAYD,wCAMvBE,GACT,IAAK,IAAIC,EAAI,EAAGA,EAzBI,MAyBiBA,EACpC,IAAK,IAAIC,EAAI,EAAGA,EA3BE,MA2BkBA,EAAG,CACtC,IAAMC,EAAQ,IAAJF,EAAUC,EAEpBtB,KAAKwB,MAAMD,GA5BI,WA4BcH,EAAOG,0CAMtCvB,KAAKyB,UAAUC,KAAKC,IAAI3B,KAAK4B,MAC7B5B,KAAK6B,QAAQC,aAAa9B,KAAKyB,UAAW,EAAG,uCAGlCP,GACXlB,KAAK6B,QAAUX,EAAOa,WAAW,MACjC/B,KAAKyB,UAAYzB,KAAK6B,QAAQG,aAC7B,EACA,EA5CkB,IACC,KAiDpBhC,KAAK6B,QAAQI,UAAY,QACzBjC,KAAK6B,QAAQK,SAAS,EAAG,EAnDN,IACC,KAqDpBlC,KAAKmC,IAAM,IAAIC,YAAYpC,KAAKyB,UAAUC,KAAKW,QAG/CrC,KAAK4B,KAAO,IAAIU,kBAAkBtC,KAAKmC,KACvCnC,KAAKwB,MAAQ,IAAIe,YAAYvC,KAAKmC,KAGlC,IAAK,IAAIZ,EAAI,EAAGA,EAAIvB,KAAKwB,MAAMa,SAAUd,EACxCvB,KAAKwB,MAAMD,GA5DK,kBAEiBiB,aCP9BC,EAAM,OAESC,aACpB,SAAAA,EAAYC,GAAoB,IAAA9C,EAAAG,KAAX4C,EAAWC,UAAAR,OAAA,QAAAS,IAAAD,UAAA,GAAAA,UAAA,GAALJ,EAAK3C,OAAAC,EAAA,EAAAD,CAAAE,KAAA0C,GAAA1C,KAoBhC+C,KAAO,WACN,GAAKlD,EAAKmD,WAAV,CACAnD,EAAKoD,SAAWC,sBAAsBrD,EAAKkD,MAE3C,IAAMI,EAAMC,KAAKD,MACXE,EAAcF,EAAMtD,EAAKyD,UAE3BD,EAAcxD,EAAK0D,YACtB1D,EAAKyD,UAAYH,EAAOE,EAAcxD,EAAK0D,UAC3C1D,EAAK8C,aA5BN3C,KAAK2C,QAAUA,EAEf3C,KAAKwD,KAAOZ,EACZ5C,KAAKuD,UAAY,IAAOX,EACxB5C,KAAKsD,UAAYF,KAAKD,MACtBnD,KAAKyD,WAAazD,KAAKsD,UACvBtD,KAAKgD,YAAa,sDAIlBhD,KAAKgD,YAAa,EAClBhD,KAAK+C,sCAIL/C,KAAKgD,YAAa,EAClBU,qBAAqB1D,KAAKiD,kDChBtBU,EAAc,KAGCC,aACpB,SAAAA,IAAe9D,OAAAC,EAAA,EAAAD,CAAAE,KAAA4D,GACd5D,KAAK6D,WAAaF,EAClB3D,KAAKoB,OAAS,IAAI0C,IAA6B,EAAlB9D,KAAK6D,YAElC7D,KAAK+D,YAAc/D,KAAK+D,YAAY1D,KAAKL,MACzCA,KAAKgE,gBAAkBhE,KAAKgE,gBAAgB3D,KAAKL,0DAG1C,IAAAH,EAAAG,KACHA,KAAKiE,UACJC,OAAOC,eAEZnE,KAAKiE,SAAW,IAAIC,OAAOC,aAC3BnE,KAAKoE,WAAapE,KAAKiE,SAASI,sBAAsB,KAAM,EAAG,GAC/DrE,KAAKoE,WAAWE,eAAiBtE,KAAKgE,gBACtChE,KAAKuE,SAAWvE,KAAKiE,SAASO,aAC9BxE,KAAKuE,SAASE,KAAKC,MAAQC,UAAOC,MAAMH,KACxCzE,KAAKuE,SAASM,QAAQ7E,KAAKiE,SAASa,aACpC9E,KAAKoE,WAAWS,QAAQ7E,KAAKuE,UAE7BQ,UAAIC,GACH,SACA,SAACP,GAAD,OAAU5E,EAAK0E,WAAa1E,EAAK0E,SAASE,KAAKC,MAAQD,qCAKpDzE,KAAKoE,aACRpE,KAAKuE,SAASU,WAAWjF,KAAKiE,SAASa,aACvC9E,KAAKoE,WAAWa,WAAWjF,KAAKuE,UAChCvE,KAAKoE,WAAWE,eAAiB,KACjCtE,KAAKoE,WAAa,KAClBpE,KAAKuE,SAAW,MAGbvE,KAAKiE,WACRjE,KAAKiE,SAASiB,QAAQC,MAAMC,QAAQC,OACpCrF,KAAKiE,SAAW,MAGjBc,UAAIO,eAAe,kDAInB,IAAKpB,OAAOC,aAAc,OA/CA,MAiD1B,IAAMtC,EAAU,IAAIqC,OAAOC,aACrBoB,EAAa1D,EAAQ0D,WAG3B,OAFA1D,EAAQqD,QAEDK,sCAGIC,EAAMC,GACbzF,KAAKoB,OAAOsE,OAAS,GAAK1F,KAAK6D,YAElC7D,KAAKoB,OAAOuE,KAAK3F,KAAK6D,WAAa,GAGpC7D,KAAKoB,OAAOwE,IAAIJ,GAChBxF,KAAKoB,OAAOwE,IAAIH,2CAGDI,GACf,IAIIC,EAJEN,EAAOK,EAAME,aAAaC,eAAe,GACzCP,EAAQI,EAAME,aAAaC,eAAe,GAC1CN,EAAOF,EAAKnD,OAGlB,IACCyD,EAAU9F,KAAKoB,OAAOuE,KAAY,EAAPD,GAC1B,MAAOO,GAIR,IAAK,IAAI1E,EAAI,EAAGA,EAAImE,EAAMnE,IACzBiE,EAAKjE,GAAK,EACVkE,EAAMlE,GAAK,EAGZ,OAGD,IAAK,IAAIA,EAAI,EAAGA,EAAImE,EAAMnE,IACzBiE,EAAKjE,GAAKuE,EAAY,EAAJvE,GAClBkE,EAAMlE,GAAKuE,EAAY,EAAJvE,EAAQ,6BC3FxB2E,EAAO,CACZ,EACA,EACA,EACA,EACA,GACA,GACA,GACA,KAGoBC,aACpB,SAAAA,IAAgC,IAApBC,EAAoBvD,UAAAR,OAAA,QAAAS,IAAAD,UAAA,GAAAA,UAAA,GAAX,EAAGwD,EAAQxD,UAAAR,OAAA,EAAAQ,UAAA,QAAAC,EAAAhD,OAAAC,EAAA,EAAAD,CAAAE,KAAAmG,GAC/BnG,KAAKoG,OAASA,EACdpG,KAAKqG,OAASA,EAEdrG,KAAKsG,QAAU,CACdC,UAAU,EACVC,UAAU,EACVC,eAAe,EACfC,cAAc,EACdC,WAAW,EACXC,aAAa,EACbC,aAAa,EACbC,cAAc,uDAIRC,GACP/G,KAAKgH,KAAK,cAAeD,EAAOb,EAAK,KACrClG,KAAKgH,KAAK,cAAeD,EAAOb,EAAK,KACrClG,KAAKgH,KAAK,mBAAoBD,EAAOb,EAAK,KAC1ClG,KAAKgH,KAAK,kBAAmBD,EAAOb,EAAK,KACzClG,KAAKgH,KAAK,eAAgBD,EAAOb,EAAK,KACtClG,KAAKgH,KAAK,iBAAkBD,EAAOb,EAAK,KACxClG,KAAKgH,KAAK,iBAAkBD,EAAOb,EAAK,KACxClG,KAAKgH,KAAK,kBAAmBD,EAAOb,EAAK,kCAGrCe,EAAQC,GACZ,IAAMC,EAAMnH,KAAKqG,UAEZrG,KAAKsG,QAAQW,IAAWC,GAC5BlH,KAAKsG,QAAQW,IAAU,EACvBE,EAAIC,WAAWpH,KAAKoG,OAAQiB,IAAMlB,WAAWc,KACnCjH,KAAKsG,QAAQW,KAAYC,IACnClH,KAAKsG,QAAQW,IAAU,EACvBE,EAAIG,SAAStH,KAAKoG,OAAQiB,IAAMlB,WAAWc,sCAIf,IAAvBM,EAAuB1E,UAAAR,OAAA,QAAAS,IAAAD,UAAA,GAAAA,UAAA,GAAd7C,KAAKsG,QACpB,OACEiB,EAAOhB,UAAYL,EAAK,KACxBqB,EAAOf,UAAYN,EAAK,KACxBqB,EAAOd,eAAiBP,EAAK,KAC7BqB,EAAOb,cAAgBR,EAAK,KAC5BqB,EAAOZ,WAAaT,EAAK,KACzBqB,EAAOX,aAAeV,EAAK,KAC3BqB,EAAOV,aAAeX,EAAK,KAC3BqB,EAAOT,cAAgBZ,EAAK,qCCzDXsB,cACpB,SAAAA,EAAYpB,EAAQC,GAA4B,IAAAxG,EAApB4H,EAAoB5E,UAAAR,OAAA,QAAAS,IAAAD,UAAA,GAAAA,UAAA,GAAV,aAAU,OAAA/C,OAAAC,EAAA,EAAAD,CAAAE,KAAAwH,IAC/C3H,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA0H,GAAArH,KAAAH,KAAMoG,EAAQC,KA2BfqB,0BAA4B,WAC3B,IAAMC,EAAUC,IAAEC,MAAMC,UAAUC,eAClC,GAAKJ,GAA+B,aAApBA,EAAQK,QAAxB,CAEA,IAAMd,EAAY,SAACe,GAAD,OAAQN,EAAQrB,QAAQ2B,GAAIC,SAE9CrI,EAAKsI,WAAW,WAAYjB,EAAU,IACtCrH,EAAKsI,WAAW,WAAYjB,EAAU,IACtCrH,EAAKsI,WAAW,gBAAiBjB,EAAU,IAC3CrH,EAAKsI,WAAW,eAAgBjB,EAAU,IAC1CrH,EAAKsI,WAAW,YAAajB,EAAU,KACvCrH,EAAKsI,WAAW,cAAejB,EAAU,KACzCrH,EAAKsI,WAAW,cAAejB,EAAU,KACzCrH,EAAKsI,WAAW,eAAgBjB,EAAU,OAzCKrH,EA4ChDuI,WAAa,SAACnC,GACb,IAAMgB,EAASpH,EAAKwI,OAAOpC,EAAEqC,KACxBrB,GAELpH,EAAKsI,WAAWlB,GAAQ,IAhDuBpH,EAmDhD0I,SAAW,SAACtC,GACX,IAAMgB,EAASpH,EAAKwI,OAAOpC,EAAEqC,KACxBrB,GAELpH,EAAKsI,WAAWlB,GAAQ,IApDxBpH,EAAK2I,iBAAmBZ,IAAEa,MAAM5I,EAAKyG,SACrCzG,EAAK4H,QAAUA,EACf5H,EAAKwI,OAAS1D,UAAO+D,QAAQC,MALkB9I,wEAS/C,OAAOC,OAAA8I,EAAA,EAAA9I,QAAAI,EAAA,EAAAJ,CAAA0H,EAAAqB,WAAA,SAAA7I,MAAAG,KAAAH,KAAaA,KAAKwI,mDAGjB,IAAAhI,EAAAR,KACR8I,YAAY,WACXtI,EAAKkH,6BACH,IAEHxD,OAAO6E,iBAAiB,UAAW/I,KAAKoI,YACxClE,OAAO6E,iBAAiB,QAAS/I,KAAKuI,UACtCxD,UAAIC,GAAG,iBAAkB,kBAAOxE,EAAK6H,OAAS1D,UAAO+D,QAAQC,yCAI7DzE,OAAO8E,oBAAoB,UAAWhJ,KAAKoI,YAC3ClE,OAAO8E,oBAAoB,QAAShJ,KAAKuI,UACzCxD,UAAIO,eAAe,qDAiCT2B,EAAQC,GACH,iBAAXD,GAA6BC,GAAWlH,KAAKyH,UAEjDzH,KAAKwI,iBAAiBvB,GAAUC,EAC5BlH,KAAKiJ,UAAUjJ,KAAKgH,KAAKC,EAAQC,oCAIrC,OAAuB,IAAhBlH,KAAKoG,cAnE+BD,GCH9B+C,ECFA,CACdC,UAAW,YACXC,UAAW,aACXC,WAAY,gBACZC,SAAU,aACVC,OAAQ,UACRC,UAAW,aACXC,aAAc,4BACdC,cAAe,WACfC,aAAc,UACdC,OAAQ,CACPC,iBAAkB,uBAClBC,WAAY,iBACZC,aAAc,yBAEfpB,MAAO,QACPjJ,KAAM,OACNsK,QAAS,aACTC,WAAY,cACZC,YAAa,eACbC,SAAU,WACVvF,MAAO,QACPwF,UAAW,aACXC,kBAAmB,wBACnBC,QAAS,aACTC,mBAAoB,wBCvBNC,cCQd,SAAAA,EAAY5K,GAAO,IAAAC,EAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAwK,GAGlB,IAAMnE,EAAS,kBAAMxG,EAAKsH,KAHR,OAClBtH,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA0K,GAAArK,KAAAH,KAAMJ,KAGD6K,gBAAkB,IAAIjD,EAAgB,EAAGnB,EAAQzG,EAAM8K,gBAC5D7K,EAAK8K,iBAAmB,IAAIxE,EAAW,EAAGE,GALxBxG,wEAQV,IAAAW,EAAAR,KACR,OACCS,EAAAC,EAAAC,cAACiK,EAAD,CACC3J,IAAK,SAACH,GACDA,GAAQN,EAAKqK,YAAY/J,kDAOhCd,KAAKyK,gBAAgBK,qDAGFC,GACnB/K,KAAKgL,uCAILhL,KAAKiL,WAAWC,QAChBlL,KAAKmL,SAASD,uCAIdlL,KAAKiL,WAAWD,OAChBhL,KAAKmL,SAASH,uCAId,IACChL,KAAKmH,IAAIiE,QACTpL,KAAKc,OAAOP,cACX,MAAO0F,GACRjG,KAAKJ,MAAMyL,QAAQnC,EAAQU,OAAOE,YAAY,mDAK/C9J,KAAKgL,OACLhL,KAAKyK,gBAAgBa,6CAGVxK,GAAQ,IAAAyK,EAAAvL,KAAAwL,EACMxL,KAAKJ,MAAtB6L,EADWD,EACXC,IAAKJ,EADMG,EACNH,QACb,GAAKI,EAAL,CACA,IAAMC,EAAQC,SAAOC,KAAKH,GAAKI,SAAS,UAExC7L,KAAKc,OAASA,EAEdd,KAAKmL,SAAW,IAAIvH,EAEpB5D,KAAKmH,IAAM,IAAI2E,MAAI,CAClBnJ,QAAS3C,KAAKc,OAAOV,UACrB2L,cAAe/L,KAAKmL,SAASpH,YAC7BwB,WAAYvF,KAAKmL,SAASa,kBAG3BhM,KAAKiL,WAAa,IAAIvI,EAAW,WAAM,IAC9BuJ,EAAWV,EAAK3L,MAAhBqM,OAEJA,EAAQA,EAAOjF,OACduE,EAAKH,UAIX,IACCpL,KAAKmH,IAAI+E,QAAQR,GAChB,MAAOzF,GACRoF,EAAQnC,EAAQU,OAAOE,YAAY,GAIpC5F,OAAOiI,SAAWnM,KAClBkE,OAAOmD,MAAQA,YAlFqB7E,wFCJjB4J,mLACX,IACAC,EAAarM,KAAKJ,MAAlByM,SAER,OACC5L,EAAAC,EAAAC,cAAA,WAASC,UAAU,iBAClBH,EAAAC,EAAAC,cAAA,OACCC,UAAW0L,IACVzL,IAAO0L,QACP,cACA,YACA,aAGD9L,EAAAC,EAAAC,cAAA,SAAI0L,IAEL5L,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,IAAO2L,UAAWC,IAAKC,IAAWC,IAAI,sBAjBdnK,8BCCvBoK,6MACpBC,MAAQ,CAAEnB,MAAO,8EAER,IACAW,EAAarM,KAAKJ,MAAlByM,SAER,OACC5L,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,IAAOzB,QACtBqB,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,IAAOxB,QACpBuI,IAAEkF,QAAQT,IACX5L,EAAAC,EAAAC,cAACoM,EAAD,CACCnM,UAAW0L,IAAWzL,IAAOvB,QAASuB,IAAOxB,QAE5CgN,IAKJ5L,EAAAC,EAAAC,cAAA,MAAIC,UAAWC,IAAOtB,OACrBkB,EAAAC,EAAAC,cAAA,WACCF,EAAAC,EAAAC,cAAA,KAAGC,UAAW0L,IAAWzL,IAAOrB,UAAW,cAC3CiB,EAAAC,EAAAC,cAAA,QAAMC,UAAWC,IAAOpB,WAAxB,cAGDgB,EAAAC,EAAAC,cAAA,WACCF,EAAAC,EAAAC,cAAA,KACCqM,KAAK,kDACLC,OAAO,SACPC,IAAI,sBACJC,SAAS,MAET1M,EAAAC,EAAAC,cAAA,KACCC,UAAW0L,IACVzL,IAAOnB,KACPmB,IAAOrB,UACP,4BAnC2BgD,8BCJf4K,aACpB,SAAAA,EAAY3B,EAAK4B,GAAUvN,OAAAC,EAAA,EAAAD,CAAAE,KAAAoN,GAC1BpN,KAAKyL,IAAMA,EACXzL,KAAKqN,QAAUA,EAEfrN,KAAKsN,MAAQ,EACbtN,KAAKuN,OAAS9B,EAAI+B,6DAIlB,GAAIxN,KAAKsN,QAAUtN,KAAKuN,OAEvB,OADAvN,KAAKqN,QAAQI,KAAK,QACX,EAGR,IAAMC,EAAY1N,KAAKuN,OAASvN,KAAKsN,MAC/B5H,EAAOiI,KAAKC,IAlBD,KAkBiBF,GAC5BG,EAAQ7N,KAAKyL,IAAIqC,MAAM9N,KAAKsN,MAAOtN,KAAKsN,MAAQ5H,GAEtD1F,KAAKsN,OAAS5H,EACd1F,KAAKqN,QAAQI,KAAKI,uCAIlB,OAAO7N,KAAKsN,eC1BOS,aACpB,SAAAA,EAAYV,GAAUvN,OAAAC,EAAA,EAAAD,CAAAE,KAAA+N,GACrB/N,KAAKyL,IAAM,IAAIrJ,YACfpC,KAAKqN,QAAUA,EAEfrN,KAAKgO,UAAY,kDAGdtC,GACH1L,KAAKyL,IAAMzL,KAAKiO,cAAcjO,KAAKyL,IAAKC,GAExC1L,KAAKgO,WAAatC,EAAM8B,WACxBxN,KAAKqN,QAAQI,KAAK,8CAGLS,EAASC,GACtB,IAAIC,EAAM,IAAIC,WAAWH,EAAQV,WAAaW,EAAQX,YAGtD,OAFAY,EAAIzM,IAAI,IAAI0M,WAAWH,GAAU,GACjCE,EAAIzM,IAAI,IAAI0M,WAAWF,GAAUD,EAAQV,YAClCY,EAAIhN,2CAIX,OAAOpB,KAAKgO,mBCjBRM,EACQ,EADRA,EAEI,EAGWC,eACpB,SAAAA,EAAYlB,GAAS,IAAAxN,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAuO,IACpB1O,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAyO,GAAApO,KAAAH,QAEKqN,QAAUA,EACfxN,EAAK2O,SACL3O,EAAKwN,QAAQrI,GAAG,OAAQ,SAAC0G,GAAD,OAAW7L,EAAK4O,QAAQ/C,KAL5B7L,sEAQd,IACE6O,EAAsB/J,UAAOwE,UAA7BuF,kBAGP1O,KAAK2O,SAAWL,GAChBtO,KAAK4O,aAAeF,EAEpB3J,UAAI8J,KAAK,aAAa,IAIvB9J,UAAI8J,KAAK,aAAa,GACtB7O,KAAK8O,mDAGQrD,GACbzL,KAAK+O,UAAY,IAAI3B,EAAK3B,EAAKzL,KAAKqN,SACpCrN,KAAK+O,UAAUC,MACfhP,KAAK6O,KAAK,MAAOpD,qCAGRA,GACTzL,KAAKqN,QAAQI,KAAK,WAClBzN,KAAKwO,SACLxO,KAAKiP,cAAcxD,8CAGDU,GAClBnM,KAAKkP,UAAY/C,EAEjBA,EAAS1B,gBAAgBrE,OAAS,EAClC+F,EAASxB,iBAAiBvE,OAAS,6EAMnCpG,KAAK+O,UAAY,KACjB/O,KAAK2O,OAASL,EACdtO,KAAK6O,KAAK,SACV9J,UAAI8J,KAAK,UAAW,MACpB9J,UAAI8J,KAAK,aAAa,uCAGX,IACHH,EAAsB/J,UAAOwE,UAA7BuF,kBAGR,GAAI1O,KAAKmP,QAAQ9M,OAASqM,EACzB,IAAK,IAAInN,EAAI,EAAGA,EAAIvB,KAAKmP,QAAQ9M,OAASqM,EAAmBnN,IAC5DvB,KAAKmP,QAAQC,QAGf,IAAM1D,EAAQ1L,KAAKmP,QAAQC,QAC3B,GAAI1D,EAAO,CAEV,IAAM2D,EAAgB,IAAIhB,WAAW3C,GAAO,GAC5C1L,KAAKkP,UAAUvE,iBAAiB2E,QAAQD,GAKzC,IAAMjO,EAAS,IAAIiN,WAAW,GAC9BjN,EAAO,GAAKpB,KAAKkP,UAAUzE,gBAAgB8E,SAC3CnO,EAAO,GAAKpB,KAAKkP,UAAUvE,iBAAiB4E,SAC5CvP,KAAKqN,QAAQI,KAAKrM,GAClBpB,KAAK4O,eAEL5O,KAAKkP,UAAU9D,wCAGRM,GACP,OAAQ1L,KAAK2O,QACZ,KAAKL,EACJ,GAAc,SAAV5C,EACc1L,KAAK+O,UAAUC,OAClBjK,UAAI8J,KAAK,UAAW3F,EAAQoB,aACtB,UAAVoB,GAAmB1L,KAAKwP,SAEnC,MACD,KAAKlB,EACJtO,KAAKmP,QAAQM,KAAK/D,GAClB1L,KAAK4O,aAAe,oCAQtB5O,KAAK2O,OAASL,EACdtO,KAAK+O,UAAY,KACjB/O,KAAKmP,QAAU,GACfnP,KAAK4O,aAAe,EAEpB7J,UAAI8J,KAAK,aAAa,UAxGkBa,KCLpCpB,GACU,EADVA,GAEU,EAFVA,GAGI,EAGWqB,eACpB,SAAAA,EAAYtC,GAAS,IAAAxN,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAA2P,IACpB9P,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA6P,GAAAxP,KAAAH,QAEKqN,QAAUA,EACfxN,EAAK2O,SACL3O,EAAKwN,QAAQrI,GAAG,OAAQ,SAAC0G,GAAD,OAAW7L,EAAK4O,QAAQ/C,KAChD7L,EAAK+P,kBAAmB,EANJ/P,sEASd,IAAAgQ,EACmClL,UAAOwE,UAAxC2G,EADFD,EACEC,cAAeC,EADjBF,EACiBE,cAGvB,GAAI/P,KAAKmP,QAAQ9M,OAASyN,EAGzB,OAFA9P,KAAKgQ,cAAe,OACpBjL,UAAI8J,KAAK,aAAa,GAKvB,GAAI7O,KAAKmP,QAAQ9M,OAAS0N,EACzB,IAAK,IAAIxO,EAAI,EAAGA,EAAIvB,KAAKmP,QAAQ9M,OAAS0N,EAAexO,IACxDvB,KAAK8O,YAIH9O,KAAKgQ,cAAgBhQ,KAAKmP,QAAQ9M,OAAS0N,GAC1C/P,KAAK8O,kDAGGrD,sCAEJA,+CAESU,GAClBnM,KAAKkP,UAAY/C,EAEjBpH,UAAI8J,KAAK,aAAa,GACtB1C,EAAS1B,gBAAgBrE,OAAS,EAClC+F,EAASxB,iBAAiBvE,OAAS,2CAI/BpG,KAAK2O,SAAWL,KACnBtO,KAAK4P,kBAAmB,EACxB5P,KAAKwP,2CAKNxP,KAAK6O,KAAK,SACV7O,KAAKqN,QAAQI,KAAK,SAClB1I,UAAI8J,KAAK,UAAW,MACpB7O,KAAK2O,OAASL,uCAIdtO,KAAKiQ,cAAe,EACpBlL,UAAI8J,KAAK,aAAa,GAEtB,IAAMnD,EAAQ1L,KAAKmP,QAAQC,QACrBC,EAAgB,IAAIhB,WAAW3C,GAAO,GACtCwE,EAAe,IAAI7B,WAAW3C,GAAO,GAC3C1L,KAAKkP,UAAUvE,iBAAiB2E,QAAQD,GACxCrP,KAAKkP,UAAUzE,gBAAgB6E,QAAQY,GAEvClQ,KAAKkP,UAAU9D,wCAGRM,GACP,GAAc,YAAVA,EAKJ,OAAQ1L,KAAK2O,QACZ,KAAKL,GACU,QAAV5C,GACH1L,KAAK6O,KAAK,MAAO7O,KAAK+O,UAAUtD,KAChCzL,KAAK+O,UAAY,KAEb/O,KAAK4P,iBAAkB5P,KAAKwP,UAE/BzK,UAAI8J,KAAK,UAAW3F,EAAQe,YAC5BjK,KAAK2O,OAASL,KAGftO,KAAK+O,UAAUC,IAAItD,GAGpB,MACD,KAAK4C,GACJ,IAAKtO,KAAKkP,UAAW,OAErBlP,KAAKmP,QAAQM,KAAK/D,GAElB,IAAMtK,EAAS,IAAIiN,WAAW,GAC9BjN,EAAO,GAAKpB,KAAKkP,UAAUzE,gBAAgB8E,SAC3CvP,KAAKqN,QAAQI,KAAKrM,QA3BnBpB,KAAKwO,0CAmCNxO,KAAK2O,OAASL,GACdtO,KAAK+O,UAAY,IAAIhB,EAAQ/N,KAAKqN,SAClCrN,KAAKgQ,cAAe,EACpBhQ,KAAKmP,QAAU,GAEfpK,UAAI8J,KAAK,aAAa,UAhHiBa,yBCNnCS,GAAsB,IAEPC,8MACpBvD,MAAQ,CAAEwD,MAAO,KAAM9G,QAAQ,EAAO+G,QAAQ,KAkD9CC,UAAY,SAACtK,GACZA,EAAEuK,iBAEF1I,UAAU2I,UAAUC,UAAUzK,EAAEgH,OAAOD,MACvCnN,EAAK8Q,SAAS,CAAEpH,QAAQ,IACxBqH,WAAW,WACV/Q,EAAK8Q,SAAS,CAAEpH,QAAQ,KACtB4G,6EAvDK,IACAU,EAAa7Q,KAAKJ,MAAlBiR,SADAC,EAE0B9Q,KAAK6M,MAA/BwD,EAFAS,EAEAT,MAAO9G,EAFPuH,EAEOvH,OAAQ+G,EAFfQ,EAEeR,OAEvB,OACC7P,EAAAC,EAAAC,cAACoQ,EAAD,KACExH,EACA9I,EAAAC,EAAAC,cAAA,YAAOuI,EAAQK,QACZsH,EACHpQ,EAAAC,EAAAC,cAAA,YAAOuI,EAAQO,cACZ4G,EACH5P,EAAAC,EAAAC,cAAA,YACEuI,EAAQkB,UAAW,IACpB3J,EAAAC,EAAAC,cAAA,KACCqM,KAAI,UAAAgE,OAAYX,EAAZ,UACJY,QAASjR,KAAKuQ,UACdpD,SAAS,MAERjE,EAAQxJ,MACL,IACJwJ,EAAQmB,mBAEPiG,EACH7P,EAAAC,EAAAC,cAAA,YAAOuI,EAAQU,OAAOG,cAEtBtJ,EAAAC,EAAAC,cAAA,YAAOuI,EAAQc,6FAMMe,2FACgB/K,KAAKJ,MAArCiR,aAAUK,aAAU7F,aACxBwF,IAAY7Q,KAAKqN,kFAGC8D,KAASC,uBAA9BpR,KAAKqN,eACLrN,KAAKqN,QACHrI,GAAG,YAAa,WAChBkM,EAAS,IAAI3C,GAAa/N,EAAK6M,YAE/BrI,GAAG,eAAgBqG,GACrBrL,KAAK2Q,SAAS,CAAEN,MAAOrQ,KAAKqN,QAAQgD,MAAOC,QAAQ,sDAEnDtQ,KAAK2Q,SAAS,CAAEL,QAAQ,wHA/Ce9N,aCFrB6O,oLAEnB,OACC5Q,EAAAC,EAAAC,cAACoQ,EAAD,KACCtQ,EAAAC,EAAAC,cAAA,YAAOuI,EAAQG,sLAMarJ,KAAKJ,MAA3BsR,aAAU7F,8BAGK8F,KAASG,YAAYtR,KAAKJ,MAAMyQ,eAAhDhD,UAEJrI,GAAG,YAAa,WAChBkM,EAAS,IAAIvB,GAAYtC,MAEzBrI,GAAG,eAAgBqG,mDAErBA,sHApBqC7I,iCCJnB+O,8MAuBpBC,UAAY,WACP3R,EAAKD,MAAM6R,YAAa5R,EAAKD,MAAM8R,iBAClC7R,EAAKD,MAAM+R,yFAxBR,IAAAnG,EACqDxL,KAAKJ,MAA1DgS,EADApG,EACAoG,YAAaH,EADbjG,EACaiG,YADbI,EAAArG,EAC0BsG,sBAD1B,IAAAD,KAGR,OACCpR,EAAAC,EAAAC,cAAA,UACCoR,KAAK,SACLnR,UAAU,qBACVqQ,QAASjR,KAAKwR,WAEd/Q,EAAAC,EAAAC,cAAA,QACCqR,MACCF,EACG,CAAEG,UAAW,eAAgBC,QAAS,gBACtC,MAGHT,EAAc,MAAQG,WAjBYpP,iCCOlC2P,GAAU,CACf,CAAEC,KAAM,cAAeR,YAAa,KACpC,CAAEQ,KAAM,eAAgBR,YAAa,KACrC,CAAEQ,KAAM,YAAaR,YAAa,IAAKE,gBAAgB,GACvD,CAAEM,KAAM,cAAeR,YAAa,KACpC,CAAEQ,KAAM,WAAYR,YAAa,KACjC,CAAEQ,KAAM,WAAYR,YAAa,KACjC,CAAEQ,KAAM,gBAAiBR,YAAa,UACtC,CAAEQ,KAAM,eAAgBR,YAAa,UAGjBS,8MACpBxF,MAAQ,CAAEyF,cAAe,QA8IzBC,SAAW,WACVxN,UAAI8J,KAAK,oBAGV2D,eAAiB,WAChB7N,UAAO8N,QACP5S,EAAK6S,aAGNlB,UAAY,WACP3R,EAAKD,MAAM6R,cAEf5R,EAAKD,MAAM+R,gBACXzN,OAAO6E,iBAAiB,UAAWlJ,EAAKuI,gBAGzCA,WAAa,SAACnC,GACb,GAAKpG,EAAKgN,MAAMyF,cAAhB,CAEArM,EAAEuK,iBAEF,IAAMmC,EAAS/K,IAAEgL,QAChBjO,UAAO+D,QAAQC,MACf,SAACkK,GAAD,OAAQA,IAAOhT,EAAKgN,MAAMyF,gBAErBQ,EAAS7M,EAAEqC,WAEV3D,UAAO+D,QAAQC,MAAMgK,GAC5BhO,UAAO+D,QAAQC,MAAMmK,GAAUjT,EAAKgN,MAAMyF,cAC1C3N,UAAOoO,OACPlT,EAAK6S,UAEL7S,EAAK8Q,SAAS,CAAE2B,cAAe,4FA3K/BpO,OAAO6E,iBAAiB,UAAW/I,KAAKoI,2DAIxClE,OAAO8E,oBAAoB,UAAWhJ,KAAKoI,6CAGnC,IAAA5H,EAAAR,KACR,OACCS,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOsJ,UACtB1J,EAAAC,EAAAC,cAAA,UACCoR,KAAK,SACLnR,UAAW0L,IAAWzL,KAAOmS,YAAa,UAAW,YACrD/B,QAASjR,KAAKuS,UAHf,KAQA9R,EAAAC,EAAAC,cAAA,UACCoR,KAAK,SACLnR,UAAW0L,IACVzL,KAAOoS,kBACP,UACA,cAEDhC,QAASjR,KAAKwS,gBAEbtJ,EAAQgB,aAGVzJ,EAAAC,EAAAC,cAAA,WACCC,UAAW0L,IAAW,gBAAiB,UAAW,eAElD7L,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAASsI,EAAQtE,OAEhCnE,EAAAC,EAAAC,cAAA,WACEgE,UAAOuO,aAAaC,IAAI,SAACN,GAAD,OACxBpS,EAAAC,EAAAC,cAAA,SAAO2H,IAAKuK,EAAGT,MACd3R,EAAAC,EAAAC,cAAA,SACCoR,KAAK,QACLnR,UAAU,oBACVwR,KAAK,QACLgB,QAASzO,UAAO+D,QAAQ9D,QAAUiO,EAAGT,KACrCiB,SAAU,SAACpN,GAAD,OAAOzF,EAAK8S,QAAQ,QAAST,EAAGT,SAE3C3R,EAAAC,EAAAC,cAAA,YAAOkS,EAAGT,WAKd3R,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAAA,WAEAF,EAAAC,EAAAC,cAAA,WACCC,UAAW0L,IAAW,gBAAiB,UAAW,eAElD7L,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAASsI,EAAQC,WAEhC1I,EAAAC,EAAAC,cAAA,WACEgE,UAAO4O,iBAAiBJ,IAAI,SAACN,GAAD,OAC5BpS,EAAAC,EAAAC,cAAA,SAAO2H,IAAKuK,EAAGT,MACd3R,EAAAC,EAAAC,cAAA,SACCoR,KAAK,QACLnR,UAAU,oBACVwR,KAAK,YACLgB,QAASzO,UAAO+D,QAAQS,YAAc0J,EAAGT,KACzCiB,SAAU,kBAAM7S,EAAK8S,QAAQ,YAAaT,EAAGT,SAE9C3R,EAAAC,EAAAC,cAAA,YAAOkS,EAAGT,WAKd3R,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAAA,WAEAF,EAAAC,EAAAC,cAAA,WACCC,UAAW0L,IAAW,gBAAiB,UAAW,eAElD7L,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAASsI,EAAQM,WAEhC/I,EAAAC,EAAAC,cAAA,WACE,EAAC,GAAM,GAAOwS,IAAI,SAACN,GAAD,OAClBpS,EAAAC,EAAAC,cAAA,SAAO2H,IAAKuK,GACXpS,EAAAC,EAAAC,cAAA,SACCoR,KAAK,QACLnR,UAAU,oBACVwR,KAAK,MACLgB,QAASzO,UAAO+D,QAAQ8K,MAAQX,EAChCQ,SAAU,kBAAM7S,EAAK8S,QAAQ,MAAOT,MAErCpS,EAAAC,EAAAC,cAAA,YAAOuI,EAAO,WAAA8H,OAAY6B,UAK9BpS,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAAA,WAEAF,EAAAC,EAAAC,cAAA,WACCC,UAAW0L,IAAW,gBAAiB,UAAW,eAElD7L,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAASsI,EAAQP,OAE/BwJ,GAAQgB,IAAI,SAAClM,GAAD,OACZxG,EAAAC,EAAAC,cAAC8S,GAAD,CACCnL,IAAKrB,EAAOmL,KACZA,KAAMnL,EAAOmL,KACbN,eAAgB7K,EAAO6K,eACvBF,YAAa3K,EAAO2K,YACpBH,YAAajR,EAAKqM,MAAMyF,gBAAkBrL,EAAOmL,KACjDT,cAAe,kBACdnR,EAAKmQ,SAAS,CAAE2B,cAAerL,EAAOmL,QAEvCV,eAAgB,kBAAMlR,EAAKmQ,SAAS,CAAE2B,cAAe,8CAQnDoB,EAAUhP,GACjBkD,IAAEjG,IAAIgD,UAAO+D,QAASgL,EAAUhP,GAChCC,UAAOoO,OACP/S,KAAK0S,4CAIL3N,UAAI8J,KAAK,SAAUlK,UAAOC,MAAMH,MAChCM,UAAI8J,KAAK,UAET,IAAM8E,EAAYC,SAASC,cAAc,cACrClP,UAAO+D,QAAQ8K,IAAKG,EAAUG,UAAUC,IAAI,OAC3CJ,EAAUG,UAAUE,OAAO,OAEhChU,KAAKiU,qBA5I+BzR,iCCbjB0R,8MACpBrH,MAAQ,CAAEsH,oBAAoB,EAAOC,WAAW,EAAO9U,QAAS,8EAEvD,IACA+U,EAAcrU,KAAdqU,UADAvD,EAE2C9Q,KAAK6M,MAAhDsH,EAFArD,EAEAqD,mBAAoBC,EAFpBtD,EAEoBsD,UAAW9U,EAF/BwR,EAE+BxR,QAEvC,OACCmB,EAAAC,EAAAC,cAAA,OAAKC,UAAW0L,IAAWzL,KAAOyT,QAASD,GAAaxT,KAAO0T,OAC9D9T,EAAAC,EAAAC,cAAA,OACCC,UAAW0L,IAAWzL,KAAO2T,OAAmB,MAAXlV,GAAmBuB,KAAO4T,OAE9DN,EACA1T,EAAAC,EAAAC,cAAC+T,GAAD,MACc,MAAXpV,EACHmB,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOvB,SAAUA,GAEjC8U,GACC3T,EAAAC,EAAAC,cAACgU,GAAAjU,EAAD,CAAQqR,KAAK,QAAQ6C,MAAM,UAAU5T,OAAO,KAAKD,MAAM,qDAQzC,IAAAP,EAAAR,KACnB+E,UACEC,GAAG,YAAa,SAACoP,GACjB5T,EAAKmQ,SAAS,CAAEyD,gBAEhBpP,GAAG,UAAW,SAAC1F,GACfkB,EAAKmQ,SAAS,CAAEyD,WAAW,EAAO9U,cAElC0F,GAAG,eAAgB,WACnBxE,EAAKmQ,SAAS,CAAEwD,oBAAoB,MAEpCnP,GAAG,gBAAiB,WACpBxE,EAAKmQ,SAAS,CAAEwD,oBAAoB,qDAKtCpP,UAAIO,eAAe,aACnBP,UAAIO,eAAe,WACnBP,UAAIO,eAAe,gBACnBP,UAAIO,eAAe,mDAInB,OACCtF,KAAK6M,MAAMsH,oBACXnU,KAAK6M,MAAMuH,WACW,MAAtBpU,KAAK6M,MAAMvN,eArDuBkD,aCFhBqS,oLACX,IAAAhV,EAAAG,KACR,OACCS,EAAAC,EAAAC,cAAA,UACCqR,MAAO,CAAEjR,MAAO,OAAQC,OAAQ,OAAQ8T,aAAc,GACtD/T,MARiB,IASjBC,OARkB,IASlBC,IAAK,SAACC,GACDA,GAAQrB,EAAKsB,YAAYD,qDAOhCwC,qBAAqB1D,KAAKiD,8CAGf/B,GACX,IAAM6T,EAAO/U,KACP6B,EAAUX,EAAOa,WAAW,MAelC,IAAIiT,GAAS,GACb,SAAUC,KACTD,GAAUA,GAETD,EAAK9R,SAAWC,sBAAsB+R,KAjBxC,SAAeC,GAQd,IAPA,IAAIC,EAAID,EAAIhU,OAAOH,MAClBqU,EAAIF,EAAIhU,OAAOF,OACfqU,EAAQH,EAAII,gBAAgBH,EAAGC,GAC/BG,EAAW,IAAIhT,YAAY8S,EAAM3T,KAAKN,QACtCoU,EAAMD,EAASlT,OACfd,EAAI,EAEEA,EAAIiU,GAAOD,EAAShU,MAAS,IAAMoM,KAAK8H,SAAY,IAAM,GAEjEP,EAAIpT,aAAauT,EAAO,EAAG,GAU3BK,CAAM7T,GACNkT,EAAK9R,SAAWC,sBAAsB+R,IAPvC,UApCmCzS,aCFtBmT,GAAA,CAAEC,iBCHF,WACd,IAAIC,EAIJA,GADAA,GADAA,GADAA,EAAM3R,OAAO4R,SAAS9I,MACZ+I,QAAQF,EAAIG,UAAUH,EAAII,QAAQ,MAAO,KACzCD,UAAUH,EAAII,QAAQ,MAAQ,IAC9BD,UAAUH,EAAII,QAAQ,MAChC/R,OAAOgS,QAAQC,aAAa,GAAI,GAAIN,IDHFO,UEHpB,SAACC,EAAQC,GAAT,SAAAtF,OACXqF,EAAOL,UAAU,EAAGM,IADTtF,OACkBqF,EAAOhU,OAASiU,EAAQ,SAAM,0BCSzDC,GAAiB,CACtBC,UAAW,IACXC,WAAY,IACZC,QAAS,KACTC,UAAW,IACXC,IAAK,WAGeC,8MA6DpBC,oBAAsB,SAAC7Q,GACI,aAAtBA,EAAE0B,QAAQK,UAEdnI,EAAKkX,aAAc,EACnBlX,EAAKoU,wFA/DL,IAAM+C,EAAQhX,KAAKiX,QAAQ,aACrBC,EAAsB,OAAVF,EAElB,OACCvW,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOyI,SAAUrB,GAAG,YACnCxH,EAAAC,EAAAC,cAAA,KAAGC,UAAW0L,IAAWzL,KAAOtB,MAAOsB,KAAOsW,WAC5CjO,EAAQI,UAEV7I,EAAAC,EAAAC,cAAA,WACCX,KAAK+W,YACLtW,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOsW,UAAWjO,EAAQqB,oBAE1C9J,EAAAC,EAAAC,cAAAF,EAAAC,EAAA0W,SAAA,KACC3W,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOwW,YACtB5W,EAAAC,EAAAC,cAAA,QAAMC,UAAWC,KAAOyW,MACvB7W,EAAAC,EAAAC,cAAA,YAAOX,KAAKiX,QAAQ,gBAAuB,IAC3CxW,EAAAC,EAAAC,cAAA,YAAOX,KAAKiX,QAAQ,iBAAwB,IAC5CxW,EAAAC,EAAAC,cAAA,QACCqR,MACCkF,EACG,CAAEjF,UAAW,eAAgBC,QAAS,gBACtC,MAGHgF,EAAY,IAAMF,GACZ,IACRvW,EAAAC,EAAAC,cAAA,YAAOX,KAAKiX,QAAQ,iBAErBxW,EAAAC,EAAAC,cAAA,QAAMC,UAAWC,KAAOyF,SACtBtG,KAAKiX,QAAQ,YADf,IAC6BjX,KAAKiX,QAAQ,cAG3CxW,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOsW,UACrBnX,KAAKiX,QAAQ,iBADf,IACkCjX,KAAKiX,QAAQ,+DAQhC,IAAAzW,EAAAR,KACnB+E,UAAIC,GAAG,SAAU,WAChBD,UAAI8J,KAAK,kBACTrO,EAAKyT,cAEL,IAAMsD,EAAU3D,SAASC,cAAc,aACvC0D,EAAQzD,UAAUE,OAAO,SACzBpD,WAAW,kBAAM2G,EAAQzD,UAAUC,IAAI,UA3DvB,OA8DjB7P,OAAO6E,iBAAiB,mBAAoB/I,KAAK8W,oEAIjD/R,UAAIO,eAAe,UACnBpB,OAAO8E,oBAAoB,oDAUpB/B,GACP,IAAMqB,EAAMV,IAAEgL,QAAQjO,UAAO+D,QAAQC,MAAO,SAACkK,GAAD,OAAQA,IAAO5L,IAC3D,OAAKqB,EAEEtI,KAAKwX,QAAQlP,GAFH,sCAKVA,GACP,OACCiO,GAAejO,KACC,IAAfA,EAAIjG,OAAeiG,EAAImP,cAAvB,IAAAzG,OAA2C2E,GAAQS,UAAU9N,EAAK,GAAlE,aA9EkC9F,iCCbjBkV,8MAgBpBC,SAAW,WACV5S,UAAI8J,KAAK,yFAfT,OACCpO,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOoG,QACtBxG,EAAAC,EAAAC,cAAA,UACCoR,KAAK,SACL5E,SAAS,KACTvM,UAAU,UACVqQ,QAASjR,KAAK2X,UAEbzO,EAAQiB,kBAV8B3H,iCCa5C0B,OAAOa,IAAM6S,EAAQ,GAAaC,QAClC3T,OAAOS,OAASiT,EAAQ,GAAaC,YAEhBC,8MACpBjL,MAAQ,CAAEpB,IAAK,KAAMQ,OAAQ,QA8E7B8L,UAAY,SAAC9L,GACZpM,EAAK8Q,SAAS,CAAE1E,WAEhBA,EAAOjH,GAAG,MAAO,SAACyG,GACjB5L,EAAKmY,SAASvM,EAAK,kBAAMQ,EAAOgM,mBAAmBpY,EAAKsM,YAAW,KAEpEF,EAAOjH,GAAG,QAAS,kBAAMnF,EAAKsM,UAAYtM,EAAKsM,SAASjB,UAExDe,EAAOgD,cAAcpP,EAAKgN,MAAMpB,QAYjCyM,YAAc,SAACjS,GACdA,EAAEuK,iBAEF,IAAM2H,EAAOvQ,IAAEC,MAAM5B,EAAEmS,aAAaC,OAC9BC,EAAS,IAAIC,WACdJ,IAELG,EAAOE,OAAS,SAAC3S,GAChB,IAAM4F,EAAM5F,EAAMoH,OAAOwL,OAErB5Y,EAAKgN,MAAMZ,OAAQpM,EAAKgN,MAAMZ,OAAOyM,UAAUjN,GAC9C5L,EAAKmY,SAASnS,EAAMoH,OAAOwL,SAGjCH,EAAOK,kBAAkBR,OAG1BS,QAAU,SAAC3S,GACVA,EAAE4S,kBACF5S,EAAEuK,oBAGHsI,gBAAkB,WACZjZ,EAAKgN,MAAMZ,QAChBpM,EAAKgN,MAAMZ,OAAOvB,oBAGnBqO,SAAW,SAAC1T,GAAwB,IAAjBoN,IAAiB5P,UAAAR,OAAA,QAAAS,IAAAD,UAAA,KAAAA,UAAA,GACnChD,EAAK8Q,SAAS,CAAElF,IAAK,OACrB1G,UAAI8J,KAAK,UAAWxJ,GAAS6D,EAAQU,OAAOC,kBACvC4I,IAEL5S,EAAK8Q,SAAS,CAAE1E,OAAQ,OACxB0J,GAAQC,mBACR1R,OAAO4R,SAAS9I,KAAO,+EAlIf,IAAAxM,EAAAR,KACAqQ,EAAUrQ,KAAKJ,MAAfyQ,MADAS,EAEgB9Q,KAAK6M,MAArBpB,EAFAqF,EAEArF,IAAKQ,EAFL6E,EAEK7E,OAEb,OACCxL,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOmY,KACrB/M,EACAxL,EAAAC,EAAAC,cAACoQ,EAAD,KAAS7H,EAAQE,WACdiH,EACH5P,EAAAC,EAAAC,cAACsY,GAAD,CACC/H,SAAUlR,KAAK+X,UACf1M,QAASrL,KAAK+Y,SACd1I,MAAOA,IAGR5P,EAAAC,EAAAC,cAACuY,GAAD,CACChI,SAAUlR,KAAK+X,UACf1M,QAASrL,KAAK+Y,SACdlI,UAAWpF,IAKZhL,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOsY,MACtB1Y,EAAAC,EAAAC,cAAA,WACCC,UAAW0L,IACVzL,KAAOuY,cACP,gBACA,UACA,eAGD3Y,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOyT,SACtB7T,EAAAC,EAAAC,cAAC0Y,GAAD,OAGA5N,EACAhL,EAAAC,EAAAC,cAAC2Y,EAAD,CACC7N,IAAKA,EACLQ,OAAQA,EACRvB,eAAgB1K,KAAK8Y,gBACrBzN,QAASrL,KAAK+Y,SACd9X,IAAK,SAACA,GAAD,OAAUT,EAAK2L,SAAWlL,KAGhCR,EAAAC,EAAAC,cAAC4Y,GAAD,QAMJ9Y,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAOyI,UACtB7I,EAAAC,EAAAC,cAAC6Y,GAAD,OAGD/Y,EAAAC,EAAAC,cAAA,OAAKC,UAAWC,KAAO4Y,MACtBhZ,EAAAC,EAAAC,cAAC+Y,GAAD,oDAOHxV,OAAO6E,iBAAiB,WAAY/I,KAAK4Y,SACzC1U,OAAO6E,iBAAiB,YAAa/I,KAAK4Y,SAC1C1U,OAAO6E,iBAAiB,OAAQ/I,KAAKkY,aACjCvT,UAAO+D,QAAQ8K,KAClBI,SAASC,cAAc,cAAcC,UAAUC,IAAI,sDAIpD7P,OAAO8E,oBAAoB,WAAYhJ,KAAK4Y,SAC5C1U,OAAO8E,oBAAoB,YAAahJ,KAAK4Y,SAC7C1U,OAAO8E,oBAAoB,OAAQhJ,KAAKkY,8CAchCzM,GAAsC,IAAAF,EAAAvL,KAAjC2Z,EAAiC9W,UAAAR,OAAA,QAAAS,IAAAD,UAAA,GAAAA,UAAA,GAAtB+E,IAAEgS,KAAM1O,IAAcrI,UAAAR,OAAA,QAAAS,IAAAD,UAAA,KAAAA,UAAA,GAC9CkC,UAAI8J,KAAK,UAAW,MAEpB7O,KAAK2Q,SAAS,CAAElF,OAAO,WACtBkO,IACIzO,GAAOK,EAAKY,SAASjB,iBA/FY1I,iCChBxC2O,KAAS0I,SACR,IAAIC,eAAY,qDAGIC,oLAInB,OAFc7V,OAAO4R,SAASkE,KAEpBC,WAAW,UACbxZ,EAAAC,EAAAC,cAACuZ,GAAD,CAAY7J,MAAOrQ,KAAKma,cACpB1Z,EAAAC,EAAAC,cAACuZ,GAAD,mDAGQ,IAAAra,EAAAG,KACpBA,KAAKoa,UAAYlW,OAAO6E,iBAAiB,aAAc,SAAC9C,GACvDpG,EAAKoU,+DAKN/P,OAAO8E,oBAAoB,aAAchJ,KAAKoa,+CAI9C,OAAOC,KAAYC,MAAMpW,OAAO4R,SAASyE,QAAQlK,aApBlBmK,sCCFjCC,IAASC,OAAOja,EAAAC,EAAAC,cAACga,GAAD,MAAS/G,SAASgH,eAAe,6BCNjD1b,EAAAC,QAAA,CAAkBmK,SAAA,2BAAA/J,MAAA,wBAAA8X,WAAA,6BAAAC,KAAA,uBAAAhR,QAAA,0BAAA6Q,SAAA,gDCAlBjY,EAAAC,QAAA,CAAkB6Z,IAAA,wBAAAG,KAAA,yBAAAC,cAAA,kCAAA9E,QAAA,4BAAAhL,SAAA,6BAAAmQ,KAAA,8CCAlBva,EAAAC,QAAA,CAAkBmV,QAAA,yBAAAC,KAAA,sBAAAC,OAAA,wBAAAC,KAAA,sBAAAnV,QAAA,8CCAlBJ,EAAAC,QAAA,CAAkBgL,SAAA,2BAAA6I,YAAA,8BAAAC,kBAAA,yDCAlB/T,EAAAC,QAAA,CAAkBoN,QAAA,gCAAAC,UAAA,sFCCHzH,EAAA,WAAI2K,GCAJ3K,gCCDf7F,EAAAC,QAAA,CAAkB2B,OAAA,4CCDlB5B,EAAAC,QAAiB0b,EAAAC,EAAuB,qDCCxC5b,EAAAC,QAAA,CAAkB8H,OAAA,8HCGZ8T,aACL,SAAAA,IAAejb,OAAAkb,EAAA,EAAAlb,CAAAE,KAAA+a,GACd/a,KAAK0I,QAAU1I,KAAKib,eACpBjb,KAAKkb,0DAILC,aAAaC,QAXH,UAWgBC,KAAKC,UAAUtb,KAAK0I,yCAI9C,IACC1I,KAAK0I,QACJ2S,KAAKf,MAAMa,aAAaI,QAjBhB,aAiBiCvb,KAAKib,eAC9C,MAAOhV,GACRjG,KAAKyS,yCAKNzS,KAAK0I,QAAU1I,KAAKib,eACpBjb,KAAK+S,qCAGM,IAAAlT,EAAAG,KACX,OAAOA,KAAKkT,aAAasI,KAAK,SAAC3I,GAAD,OAAQA,EAAGT,OAASvS,EAAK6I,QAAQ9D,0CAGhD,IAAApE,EAAAR,KACf,OAAOA,KAAKuT,iBAAiBiI,KAC5B,SAAC3I,GAAD,OAAQA,EAAGT,OAAS5R,EAAKkI,QAAQS,mDAKlC,MAAO,CACNvE,MAvCiB,MAwCjBuE,UAvCc,WAwCdqK,KAAK,EACL7K,MAAO,CACNiO,IAAK,WACL6E,EAAG,WACHC,OAAQ,gBACRC,MAAO,eACPjF,QAAS,YACTC,UAAW,cACXH,UAAW,cACXC,WAAY,sDAMd,MAAO,CACN,CAAErE,KAAM,OAAQ3N,KAAM,GACtB,CAAE2N,KAAM,MAAO3N,KAAM,IACrB,CAAE2N,KAAM,MAAO3N,KAAM,KACrB,CAAE2N,KA5De,MA4DI3N,KAAM,IAC3B,CAAE2N,KAAM,MAAO3N,KAAM,KACrB,CAAE2N,KAAM,MAAO3N,KAAM,IACrB,CAAE2N,KAAM,KAAM3N,KAAM,6CAKrB,MAAO,CACN,CACC2N,KArEa,WAsEb1D,kBAAmB,EACnBoB,cAAe,EACfC,cAAe,GAEhB,CAAEqC,KAAM,MAAO1D,kBAAmB,EAAGoB,cAAe,EAAGC,cAAe,GACtE,CACCqC,KAAM,SACN1D,kBAAmB,EACnBoB,cAAe,EACfC,cAAe,GAEhB,CAAEqC,KAAM,OAAQ1D,kBAAmB,EAAGoB,cAAe,EAAGC,cAAe,aAK3D6L,EAAA,YAAIb","file":"static/js/main.24bbc047.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__2tevk\",\"small\":\"Header_small__1uQvM\",\"message\":\"Header_message__3NbkN\",\"title\":\"Header_title__ILaB2\",\"titleLogo\":\"Header_titleLogo__2pj7o\",\"titleText\":\"Header_titleText__qd3rx\",\"link\":\"Header_link__slmNi\"};","import React, { Component } from \"react\";\r\nimport styles from \"./Screen.module.css\";\r\n\r\nconst SCREEN_WIDTH = 256;\r\nconst SCREEN_HEIGHT = 240;\r\nconst FULL_ALPHA = 0xff000000;\r\n\r\nexport default class Screen extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.setBuffer = this.setBuffer.bind(this);\r\n\t\tthis.writeBuffer = this.writeBuffer.bind(this);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<canvas\r\n\t\t\t\tclassName={styles.screen}\r\n\t\t\t\twidth={SCREEN_WIDTH}\r\n\t\t\t\theight={SCREEN_HEIGHT}\r\n\t\t\t\tref={(canvas) => {\r\n\t\t\t\t\tif (canvas) this._initCanvas(canvas);\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tsetBuffer(buffer) {\r\n\t\tfor (let y = 0; y < SCREEN_HEIGHT; ++y) {\r\n\t\t\tfor (let x = 0; x < SCREEN_WIDTH; ++x) {\r\n\t\t\t\tconst i = y * 256 + x;\r\n\t\t\t\t// Convert pixel from NES BGR to canvas ABGR\r\n\t\t\t\tthis.buf32[i] = FULL_ALPHA | buffer[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\twriteBuffer() {\r\n\t\tthis.imageData.data.set(this.buf8);\r\n\t\tthis.context.putImageData(this.imageData, 0, 0);\r\n\t}\r\n\r\n\t_initCanvas(canvas) {\r\n\t\tthis.context = canvas.getContext(\"2d\");\r\n\t\tthis.imageData = this.context.getImageData(\r\n\t\t\t0,\r\n\t\t\t0,\r\n\t\t\tSCREEN_WIDTH,\r\n\t\t\tSCREEN_HEIGHT\r\n\t\t);\r\n\r\n\t\t// Set alpha to opaque\r\n\t\tthis.context.fillStyle = \"black\";\r\n\t\tthis.context.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\r\n\r\n\t\t// Buffer to write on next animation frame\r\n\t\tthis.buf = new ArrayBuffer(this.imageData.data.length);\r\n\r\n\t\t// Get the canvas buffer in 8bit and 32bit\r\n\t\tthis.buf8 = new Uint8ClampedArray(this.buf);\r\n\t\tthis.buf32 = new Uint32Array(this.buf);\r\n\r\n\t\t// Set alpha\r\n\t\tfor (let i = 0; i < this.buf32.length; ++i) {\r\n\t\t\tthis.buf32[i] = FULL_ALPHA;\r\n\t\t}\r\n\t}\r\n}\r\n","const FPS = 60.098;\r\n\r\nexport default class FrameTimer {\r\n\tconstructor(onFrame, fps = FPS) {\r\n\t\tthis.onFrame = onFrame;\r\n\r\n\t\tthis._fps = fps;\r\n\t\tthis._interval = 1000 / fps;\r\n\t\tthis._lastTime = Date.now();\r\n\t\tthis._startTime = this._lastTime;\r\n\t\tthis._isRunning = false;\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis._isRunning = true;\r\n\t\tthis._run();\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis._isRunning = false;\r\n\t\tcancelAnimationFrame(this._frameId);\r\n\t}\r\n\r\n\t_run = () => {\r\n\t\tif (!this._isRunning) return;\r\n\t\tthis._frameId = requestAnimationFrame(this._run);\r\n\r\n\t\tconst now = Date.now();\r\n\t\tconst elapsedTime = now - this._lastTime;\r\n\r\n\t\tif (elapsedTime > this._interval) {\r\n\t\t\tthis._lastTime = now - (elapsedTime % this._interval);\r\n\t\t\tthis.onFrame();\r\n\t\t}\r\n\t};\r\n}\r\n","import RingBuffer from \"ringbufferjs\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\n\r\nconst BUFFER_SIZE = 8192;\r\nconst DEFAULT_SAMPLE_RATE = 44100;\r\n\r\nexport default class Speakers {\r\n\tconstructor() {\r\n\t\tthis.bufferSize = BUFFER_SIZE;\r\n\t\tthis.buffer = new RingBuffer(this.bufferSize * 2);\r\n\r\n\t\tthis.writeSample = this.writeSample.bind(this);\r\n\t\tthis._onAudioProcess = this._onAudioProcess.bind(this);\r\n\t}\r\n\r\n\tstart() {\r\n\t\tif (this.audioCtx) return;\r\n\t\tif (!window.AudioContext) return; // (audio is not supported)\r\n\r\n\t\tthis.audioCtx = new window.AudioContext();\r\n\t\tthis.scriptNode = this.audioCtx.createScriptProcessor(1024, 0, 2);\r\n\t\tthis.scriptNode.onaudioprocess = this._onAudioProcess;\r\n\t\tthis.gainNode = this.audioCtx.createGain();\r\n\t\tthis.gainNode.gain.value = config.sound.gain;\r\n\t\tthis.gainNode.connect(this.audioCtx.destination);\r\n\t\tthis.scriptNode.connect(this.gainNode);\r\n\r\n\t\tbus.on(\r\n\t\t\t\"volume\",\r\n\t\t\t(gain) => this.gainNode && (this.gainNode.gain.value = gain)\r\n\t\t);\r\n\t}\r\n\r\n\tstop() {\r\n\t\tif (this.scriptNode) {\r\n\t\t\tthis.gainNode.disconnect(this.audioCtx.destination);\r\n\t\t\tthis.scriptNode.disconnect(this.gainNode);\r\n\t\t\tthis.scriptNode.onaudioprocess = null;\r\n\t\t\tthis.scriptNode = null;\r\n\t\t\tthis.gainNode = null;\r\n\t\t}\r\n\r\n\t\tif (this.audioCtx) {\r\n\t\t\tthis.audioCtx.close().catch(console.error);\r\n\t\t\tthis.audioCtx = null;\r\n\t\t}\r\n\r\n\t\tbus.removeListener(\"volume\");\r\n\t}\r\n\r\n\tgetSampleRate() {\r\n\t\tif (!window.AudioContext) return DEFAULT_SAMPLE_RATE;\r\n\r\n\t\tconst context = new window.AudioContext();\r\n\t\tconst sampleRate = context.sampleRate;\r\n\t\tcontext.close();\r\n\r\n\t\treturn sampleRate;\r\n\t}\r\n\r\n\twriteSample(left, right) {\r\n\t\tif (this.buffer.size() / 2 >= this.bufferSize) {\r\n\t\t\t// buffer overrun\r\n\t\t\tthis.buffer.deqN(this.bufferSize / 2);\r\n\t\t}\r\n\r\n\t\tthis.buffer.enq(left);\r\n\t\tthis.buffer.enq(right);\r\n\t}\r\n\r\n\t_onAudioProcess(event) {\r\n\t\tconst left = event.outputBuffer.getChannelData(0);\r\n\t\tconst right = event.outputBuffer.getChannelData(1);\r\n\t\tconst size = left.length;\r\n\r\n\t\tlet samples;\r\n\t\ttry {\r\n\t\t\tsamples = this.buffer.deqN(size * 2);\r\n\t\t} catch (e) {\r\n\t\t\t// buffer underrun (needed {size}, got {this.buffer.size() / 2})\r\n\t\t\t// ignore empty buffers... assume audio has just stopped\r\n\r\n\t\t\tfor (let i = 0; i < size; i++) {\r\n\t\t\t\tleft[i] = 0;\r\n\t\t\t\tright[i] = 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < size; i++) {\r\n\t\t\tleft[i] = samples[i * 2];\r\n\t\t\tright[i] = samples[i * 2 + 1];\r\n\t\t}\r\n\t}\r\n}\r\n","import jsnes from \"jsnes\";\r\n\r\nconst BITS = [\r\n\t0b00000001,\r\n\t0b00000010,\r\n\t0b00000100,\r\n\t0b00001000,\r\n\t0b00010000,\r\n\t0b00100000,\r\n\t0b01000000,\r\n\t0b10000000\r\n];\r\n\r\nexport default class Controller {\r\n\tconstructor(player = 1, getNes) {\r\n\t\tthis.player = player;\r\n\t\tthis.getNes = getNes;\r\n\r\n\t\tthis.buttons = {\r\n\t\t\tBUTTON_A: false,\r\n\t\t\tBUTTON_B: false,\r\n\t\t\tBUTTON_SELECT: false,\r\n\t\t\tBUTTON_START: false,\r\n\t\t\tBUTTON_UP: false,\r\n\t\t\tBUTTON_DOWN: false,\r\n\t\t\tBUTTON_LEFT: false,\r\n\t\t\tBUTTON_RIGHT: false\r\n\t\t};\r\n\t}\r\n\r\n\tsyncAll(byte) {\r\n\t\tthis.sync(\"BUTTON_A\", !!(byte & BITS[0]));\r\n\t\tthis.sync(\"BUTTON_B\", !!(byte & BITS[1]));\r\n\t\tthis.sync(\"BUTTON_SELECT\", !!(byte & BITS[2]));\r\n\t\tthis.sync(\"BUTTON_START\", !!(byte & BITS[3]));\r\n\t\tthis.sync(\"BUTTON_UP\", !!(byte & BITS[4]));\r\n\t\tthis.sync(\"BUTTON_DOWN\", !!(byte & BITS[5]));\r\n\t\tthis.sync(\"BUTTON_LEFT\", !!(byte & BITS[6]));\r\n\t\tthis.sync(\"BUTTON_RIGHT\", !!(byte & BITS[7]));\r\n\t}\r\n\r\n\tsync(button, isPressed) {\r\n\t\tconst nes = this.getNes();\r\n\r\n\t\tif (!this.buttons[button] && isPressed) {\r\n\t\t\tthis.buttons[button] = true;\r\n\t\t\tnes.buttonDown(this.player, jsnes.Controller[button]);\r\n\t\t} else if (this.buttons[button] && !isPressed) {\r\n\t\t\tthis.buttons[button] = false;\r\n\t\t\tnes.buttonUp(this.player, jsnes.Controller[button]);\r\n\t\t}\r\n\t}\r\n\r\n\ttoByte(source = this.buttons) {\r\n\t\treturn (\r\n\t\t\t(source.BUTTON_A && BITS[0]) |\r\n\t\t\t(source.BUTTON_B && BITS[1]) |\r\n\t\t\t(source.BUTTON_SELECT && BITS[2]) |\r\n\t\t\t(source.BUTTON_START && BITS[3]) |\r\n\t\t\t(source.BUTTON_UP && BITS[4]) |\r\n\t\t\t(source.BUTTON_DOWN && BITS[5]) |\r\n\t\t\t(source.BUTTON_LEFT && BITS[6]) |\r\n\t\t\t(source.BUTTON_RIGHT && BITS[7])\r\n\t\t);\r\n\t}\r\n}\r\n","import Controller from \"./Controller\";\nimport config from \"../../config\";\nimport bus from \"../../events\";\nimport _ from \"lodash\";\n\nexport default class LocalController extends Controller {\n\tconstructor(player, getNes, onStart = () => {}) {\n\t\tsuper(player, getNes);\n\n\t\tthis.immediateButtons = _.clone(this.buttons);\n\t\tthis.onStart = onStart;\n\t\tthis.keyMap = config.options.input;\n\t}\n\n\ttoByte() {\n\t\treturn super.toByte(this.immediateButtons);\n\t}\n\n\tattach() {\n\t\tsetInterval(() => {\n\t\t\tthis._processGamepadIfPossible();\n\t\t}, 10);\n\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\n\t\twindow.addEventListener(\"keyup\", this._onKeyUp);\n\t\tbus.on(\"keymap-updated\", () => (this.keyMap = config.options.input));\n\t}\n\n\tdetach() {\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDown);\n\t\twindow.removeEventListener(\"keyup\", this._onKeyUp);\n\t\tbus.removeListener(\"keymap-updated\");\n\t}\n\n\t_processGamepadIfPossible = () => {\n\t\tconst gamepad = _.first(navigator.getGamepads());\n\t\tif (!gamepad || gamepad.mapping !== \"standard\") return;\n\n\t\tconst isPressed = (id) => gamepad.buttons[id].pressed;\n\n\t\tthis._setButton(\"BUTTON_A\", isPressed(1));\n\t\tthis._setButton(\"BUTTON_B\", isPressed(0));\n\t\tthis._setButton(\"BUTTON_SELECT\", isPressed(8));\n\t\tthis._setButton(\"BUTTON_START\", isPressed(9));\n\t\tthis._setButton(\"BUTTON_UP\", isPressed(12));\n\t\tthis._setButton(\"BUTTON_DOWN\", isPressed(13));\n\t\tthis._setButton(\"BUTTON_LEFT\", isPressed(14));\n\t\tthis._setButton(\"BUTTON_RIGHT\", isPressed(15));\n\t};\n\n\t_onKeyDown = (e) => {\n\t\tconst button = this.keyMap[e.key];\n\t\tif (!button) return;\n\n\t\tthis._setButton(button, true);\n\t};\n\n\t_onKeyUp = (e) => {\n\t\tconst button = this.keyMap[e.key];\n\t\tif (!button) return;\n\n\t\tthis._setButton(button, false);\n\t};\n\n\t_setButton(button, isPressed) {\n\t\tif (button === \"BUTTON_START\" && isPressed) this.onStart();\n\n\t\tthis.immediateButtons[button] = isPressed;\n\t\tif (this.isMaster) this.sync(button, isPressed);\n\t}\n\n\tget isMaster() {\n\t\treturn this.player === 1;\n\t}\n}\n","import strings from \"./strings\";\r\n\r\nexport default strings;\r\n","export default {\n\tbuffering: \"Buffering\",\n\tconnected: \"Connected!\",\n\tconnecting: \"Connecting...\",\n\tcontrols: \"-Controls-\",\n\tcopied: \"Copied!\",\n\tcrtEffect: \"CRT Effect\",\n\tdragARomHere: \"Drag a NES rom file here!\",\n\tenabled_false: \"Disabled\",\n\tenabled_true: \"Enabled\",\n\terrors: {\n\t\tconnectionFailed: \"CONNECTION FAILED :(\",\n\t\tinvalidRom: \"INVALID ROM :(\",\n\t\tserverIsDown: \"The server is down :(\"\n\t},\n\tinput: \"Input\",\n\tlink: \"link\",\n\tloading: \"Loading...\",\n\tpressStart: \"PRESS START\",\n\tsetDefaults: \"Set defaults\",\n\tsettings: \"Settings\",\n\tsound: \"Sound\",\n\tshareThis: \"Share this\",\n\ttoPlayWithSomeone: \"to play with someone!\",\n\twaiting: \"WAITING...\",\n\tyourXboxController: \"Your Xbox controller\"\n};\n","import Emulator from \"./Emulator\";\r\n\r\nexport default Emulator;\r\n","import React, { Component } from \"react\";\r\nimport { Buffer } from \"buffer\";\r\nimport Screen from \"./Screen\";\r\nimport FrameTimer from \"./FrameTimer\";\r\nimport Speakers from \"./Speakers\";\r\nimport { Controller, LocalController } from \"./controllers\";\r\nimport strings from \"../locales\";\r\nimport jsnes, { NES } from \"jsnes\";\r\n\r\nexport default class Emulator extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tconst getNes = () => this.nes;\r\n\t\tthis.localController = new LocalController(1, getNes, props.onStartPressed);\r\n\t\tthis.remoteController = new Controller(2, getNes);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Screen\r\n\t\t\t\tref={(screen) => {\r\n\t\t\t\t\tif (screen) this._initialize(screen);\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.localController.attach();\r\n\t}\r\n\r\n\tcomponentWillUpdate(nextProps) {\r\n\t\tthis.stop();\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis.frameTimer.start();\r\n\t\tthis.speakers.start();\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis.frameTimer.stop();\r\n\t\tthis.speakers.stop();\r\n\t}\r\n\r\n\tframe() {\r\n\t\ttry {\r\n\t\t\tthis.nes.frame();\r\n\t\t\tthis.screen.writeBuffer();\r\n\t\t} catch (e) {\r\n\t\t\tthis.props.onError(strings.errors.invalidRom, false);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.stop();\r\n\t\tthis.localController.detach();\r\n\t}\r\n\r\n\t_initialize(screen) {\r\n\t\tconst { rom, onError } = this.props;\r\n\t\tif (!rom) return;\r\n\t\tconst bytes = Buffer.from(rom).toString(\"binary\");\r\n\r\n\t\tthis.screen = screen;\r\n\r\n\t\tthis.speakers = new Speakers();\r\n\r\n\t\tthis.nes = new NES({\r\n\t\t\tonFrame: this.screen.setBuffer,\r\n\t\t\tonAudioSample: this.speakers.writeSample,\r\n\t\t\tsampleRate: this.speakers.getSampleRate()\r\n\t\t});\r\n\r\n\t\tthis.frameTimer = new FrameTimer(() => {\r\n\t\t\tconst { syncer } = this.props;\r\n\r\n\t\t\tif (syncer) syncer.sync();\r\n\t\t\telse this.frame();\r\n\t\t});\r\n\r\n\t\t// Load ROM data as a string and start\r\n\t\ttry {\r\n\t\t\tthis.nes.loadROM(bytes);\r\n\t\t} catch (e) {\r\n\t\t\tonError(strings.errors.invalidRom, false);\r\n\t\t}\r\n\r\n\t\t// DEBUG\r\n\t\twindow.emulator = this;\r\n\t\twindow.jsnes = jsnes;\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\nimport styles from \"./BalloonMessage.module.css\";\r\nimport haluImage from \"../assets/halu.svg\";\r\nimport classNames from \"classnames\";\r\n\r\nexport default class BalloonMessage extends Component {\r\n\trender() {\r\n\t\tconst { children } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<section className=\"message -left\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\tstyles.balloon,\r\n\t\t\t\t\t\t\"nes-balloon\",\r\n\t\t\t\t\t\t\"from-left\",\r\n\t\t\t\t\t\t\"is-small\"\r\n\t\t\t\t\t)}\r\n\t\t\t\t>\r\n\t\t\t\t\t<p>{children}</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<br />\r\n\t\t\t\t<img className={styles.character} src={haluImage} alt=\"character\" />\r\n\t\t\t</section>\r\n\t\t);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\nimport BalloonMessage from \"./BalloonMessage\";\nimport styles from \"./Header.module.css\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\nexport default class Header extends Component {\n\tstate = { bytes: null };\n\n\trender() {\n\t\tconst { children } = this.props;\n\n\t\treturn (\n\t\t\t<div className={styles.header}>\n\t\t\t\t<div className={styles.small}>\n\t\t\t\t\t{!_.isEmpty(children) && (\n\t\t\t\t\t\t<BalloonMessage\n\t\t\t\t\t\t\tclassName={classNames(styles.message, styles.small)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{children}\n\t\t\t\t\t\t</BalloonMessage>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t<h2 className={styles.title}>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<i className={classNames(styles.titleLogo, \"nes-logo\")} />\n\t\t\t\t\t\t<span className={styles.titleText}>NEStation</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"https://github.com/rodri042/nestation#nestation\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\t\tstyles.link,\n\t\t\t\t\t\t\t\t\tstyles.titleLogo,\n\t\t\t\t\t\t\t\t\t\"nes-octocat\"\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</h2>\n\t\t\t</div>\n\t\t);\n\t}\n}\n","const CHUNK_SIZE = 1024;\r\n\r\nexport default class Send {\r\n\tconstructor(rom, channel) {\r\n\t\tthis.rom = rom;\r\n\t\tthis.channel = channel;\r\n\r\n\t\tthis._sent = 0;\r\n\t\tthis._total = rom.byteLength;\r\n\t}\r\n\r\n\trun() {\r\n\t\tif (this._sent === this._total) {\r\n\t\t\tthis.channel.send(\"end\");\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst remaining = this._total - this._sent;\r\n\t\tconst size = Math.min(CHUNK_SIZE, remaining);\r\n\t\tconst chunk = this.rom.slice(this._sent, this._sent + size);\r\n\r\n\t\tthis._sent += size;\r\n\t\tthis.channel.send(chunk);\r\n\t}\r\n\r\n\tget transferred() {\r\n\t\treturn this._sent;\r\n\t}\r\n}\r\n","export default class Receive {\r\n\tconstructor(channel) {\r\n\t\tthis.rom = new ArrayBuffer();\r\n\t\tthis.channel = channel;\r\n\r\n\t\tthis._received = 0;\r\n\t}\r\n\r\n\trun(bytes) {\r\n\t\tthis.rom = this._appendBuffer(this.rom, bytes);\r\n\r\n\t\tthis._received += bytes.byteLength;\r\n\t\tthis.channel.send(\"next\");\r\n\t}\r\n\r\n\t_appendBuffer(buffer1, buffer2) {\r\n\t\tvar tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\r\n\t\ttmp.set(new Uint8Array(buffer1), 0);\r\n\t\ttmp.set(new Uint8Array(buffer2), buffer1.byteLength);\r\n\t\treturn tmp.buffer;\r\n\t}\r\n\r\n\tget transferred() {\r\n\t\treturn this._received;\r\n\t}\r\n}\r\n","import EventEmitter from \"eventemitter3\";\r\nimport { Send } from \"./transfer\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport strings from \"../locales\";\r\n\r\nconst STATE = {\r\n\tSENDING_ROM: 0,\r\n\tPLAYING: 1\r\n};\r\n\r\nexport default class MasterSyncer extends EventEmitter {\r\n\tconstructor(channel) {\r\n\t\tsuper();\r\n\r\n\t\tthis.channel = channel;\r\n\t\tthis._reset();\r\n\t\tthis.channel.on(\"data\", (bytes) => this._onData(bytes));\r\n\t}\r\n\r\n\tsync() {\r\n\t\tconst { masterBufferLimit } = config.buffering;\r\n\r\n\t\tif (\r\n\t\t\tthis._state !== STATE.PLAYING ||\r\n\t\t\tthis._blindFrames > masterBufferLimit\r\n\t\t) {\r\n\t\t\tbus.emit(\"isLoading\", true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t\tthis._runFrame();\r\n\t}\r\n\r\n\tinitializeRom(rom) {\r\n\t\tthis._transfer = new Send(rom, this.channel);\r\n\t\tthis._transfer.run();\r\n\t\tthis.emit(\"rom\", rom);\r\n\t}\r\n\r\n\tupdateRom(rom) {\r\n\t\tthis.channel.send(\"new-rom\");\r\n\t\tthis._reset();\r\n\t\tthis.initializeRom(rom);\r\n\t}\r\n\r\n\tinitializeEmulator(emulator) {\r\n\t\tthis._emulator = emulator;\r\n\r\n\t\temulator.localController.player = 1;\r\n\t\temulator.remoteController.player = 2;\r\n\t}\r\n\r\n\tonStartPressed() {}\r\n\r\n\t_start() {\r\n\t\tthis._transfer = null;\r\n\t\tthis._state = STATE.PLAYING;\r\n\t\tthis.emit(\"start\");\r\n\t\tbus.emit(\"message\", null);\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t}\r\n\r\n\t_runFrame() {\r\n\t\tconst { masterBufferLimit } = config.buffering;\r\n\r\n\t\t// buffer overrun\r\n\t\tif (this._buffer.length > masterBufferLimit) {\r\n\t\t\tfor (let i = 0; i < this._buffer.length - masterBufferLimit; i++)\r\n\t\t\t\tthis._buffer.shift();\r\n\t\t}\r\n\r\n\t\tconst bytes = this._buffer.shift();\r\n\t\tif (bytes) {\r\n\t\t\t// normal scenario\r\n\t\t\tconst remoteButtons = new Uint8Array(bytes)[0];\r\n\t\t\tthis._emulator.remoteController.syncAll(remoteButtons);\r\n\t\t} else {\r\n\t\t\t// buffer underrun, do nothing (assume previous input)\r\n\t\t}\r\n\r\n\t\tconst buffer = new Uint8Array(2);\r\n\t\tbuffer[0] = this._emulator.localController.toByte();\r\n\t\tbuffer[1] = this._emulator.remoteController.toByte();\r\n\t\tthis.channel.send(buffer);\r\n\t\tthis._blindFrames++;\r\n\r\n\t\tthis._emulator.frame();\r\n\t}\r\n\r\n\t_onData(bytes) {\r\n\t\tswitch (this._state) {\r\n\t\t\tcase STATE.SENDING_ROM:\r\n\t\t\t\tif (bytes === \"next\") {\r\n\t\t\t\t\tconst hasEnded = this._transfer.run();\r\n\t\t\t\t\tif (hasEnded) bus.emit(\"message\", strings.waiting);\r\n\t\t\t\t} else if (bytes === \"start\") this._start();\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase STATE.PLAYING:\r\n\t\t\t\tthis._buffer.push(bytes);\r\n\t\t\t\tthis._blindFrames = 0;\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t}\r\n\r\n\t_reset() {\r\n\t\tthis._state = STATE.SENDING_ROM;\r\n\t\tthis._transfer = null;\r\n\t\tthis._buffer = [];\r\n\t\tthis._blindFrames = 0;\r\n\r\n\t\tbus.emit(\"isLoading\", true);\r\n\t}\r\n}\r\n","import EventEmitter from \"eventemitter3\";\r\nimport { Receive } from \"./transfer\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport strings from \"../locales\";\r\n\r\nconst STATE = {\r\n\tRECEIVING_ROM: 0,\r\n\tWAITING_START: 1,\r\n\tPLAYING: 2\r\n};\r\n\r\nexport default class SlaveSyncer extends EventEmitter {\r\n\tconstructor(channel) {\r\n\t\tsuper();\r\n\r\n\t\tthis.channel = channel;\r\n\t\tthis._reset();\r\n\t\tthis.channel.on(\"data\", (bytes) => this._onData(bytes));\r\n\t\tthis._hasPressedStart = false;\r\n\t}\r\n\r\n\tsync() {\r\n\t\tconst { minBufferSize, maxBufferSize } = config.buffering;\r\n\r\n\t\t// buffer underrun\r\n\t\tif (this._buffer.length < minBufferSize) {\r\n\t\t\tthis._isBuffering = true;\r\n\t\t\tbus.emit(\"isLoading\", true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// buffer overrun\r\n\t\tif (this._buffer.length > maxBufferSize) {\r\n\t\t\tfor (let i = 0; i < this._buffer.length - maxBufferSize; i++)\r\n\t\t\t\tthis._runFrame();\r\n\t\t}\r\n\r\n\t\t// normal scenario\r\n\t\tif (this._isBuffering && this._buffer.length < maxBufferSize) return;\r\n\t\telse this._runFrame();\r\n\t}\r\n\r\n\tinitializeRom(rom) {}\r\n\r\n\tupdateRom(rom) {}\r\n\r\n\tinitializeEmulator(emulator) {\r\n\t\tthis._emulator = emulator;\r\n\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t\temulator.localController.player = 2;\r\n\t\temulator.remoteController.player = 1;\r\n\t}\r\n\r\n\tonStartPressed() {\r\n\t\tif (this._state === STATE.WAITING_START) {\r\n\t\t\tthis._hasPressedStart = true;\r\n\t\t\tthis._start();\r\n\t\t}\r\n\t}\r\n\r\n\t_start() {\r\n\t\tthis.emit(\"start\");\r\n\t\tthis.channel.send(\"start\");\r\n\t\tbus.emit(\"message\", null);\r\n\t\tthis._state = STATE.PLAYING;\r\n\t}\r\n\r\n\t_runFrame() {\r\n\t\tthis._ifBuffering = false;\r\n\t\tbus.emit(\"isLoading\", false);\r\n\r\n\t\tconst bytes = this._buffer.shift();\r\n\t\tconst remoteButtons = new Uint8Array(bytes)[0];\r\n\t\tconst localButtons = new Uint8Array(bytes)[1];\r\n\t\tthis._emulator.remoteController.syncAll(remoteButtons);\r\n\t\tthis._emulator.localController.syncAll(localButtons);\r\n\r\n\t\tthis._emulator.frame();\r\n\t}\r\n\r\n\t_onData(bytes) {\r\n\t\tif (bytes === \"new-rom\") {\r\n\t\t\tthis._reset();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tswitch (this._state) {\r\n\t\t\tcase STATE.RECEIVING_ROM:\r\n\t\t\t\tif (bytes === \"end\") {\r\n\t\t\t\t\tthis.emit(\"rom\", this._transfer.rom);\r\n\t\t\t\t\tthis._transfer = null;\r\n\r\n\t\t\t\t\tif (this._hasPressedStart) this._start();\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tbus.emit(\"message\", strings.pressStart);\r\n\t\t\t\t\t\tthis._state = STATE.WAITING_START;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._transfer.run(bytes);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase STATE.PLAYING:\r\n\t\t\t\tif (!this._emulator) return;\r\n\r\n\t\t\t\tthis._buffer.push(bytes);\r\n\r\n\t\t\t\tconst buffer = new Uint8Array(1);\r\n\t\t\t\tbuffer[0] = this._emulator.localController.toByte();\r\n\t\t\t\tthis.channel.send(buffer);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t}\r\n\r\n\t_reset() {\r\n\t\tthis._state = STATE.RECEIVING_ROM;\r\n\t\tthis._transfer = new Receive(this.channel);\r\n\t\tthis._isBuffering = false;\r\n\t\tthis._buffer = [];\r\n\r\n\t\tbus.emit(\"isLoading\", true);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\nimport Header from \"../widgets/Header\";\nimport { MasterSyncer } from \"../networking\";\nimport quickp2p from \"quickp2p\";\nimport strings from \"../locales\";\n\nconst COPIED_MESSAGE_TIME = 1000;\n\nexport default class InviteHeader extends Component {\n\tstate = { token: null, copied: false, isDown: false };\n\n\trender() {\n\t\tconst { needsRom } = this.props;\n\t\tconst { token, copied, isDown } = this.state;\n\n\t\treturn (\n\t\t\t<Header>\n\t\t\t\t{copied ? (\n\t\t\t\t\t<span>{strings.copied}</span>\n\t\t\t\t) : needsRom ? (\n\t\t\t\t\t<span>{strings.dragARomHere}</span>\n\t\t\t\t) : token ? (\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{strings.shareThis}{\" \"}\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={`?token=${token}#/join`}\n\t\t\t\t\t\t\tonClick={this._copyLink}\n\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{strings.link}\n\t\t\t\t\t\t</a>{\" \"}\n\t\t\t\t\t\t{strings.toPlayWithSomeone}\n\t\t\t\t\t</span>\n\t\t\t\t) : isDown ? (\n\t\t\t\t\t<span>{strings.errors.serverIsDown}</span>\n\t\t\t\t) : (\n\t\t\t\t\t<span>{strings.loading}</span>\n\t\t\t\t)}\n\t\t\t</Header>\n\t\t);\n\t}\n\n\tasync componentDidUpdate(nextProps) {\n\t\tconst { needsRom, onSyncer, onError } = this.props;\n\t\tif (needsRom || this.channel) return;\n\n\t\ttry {\n\t\t\tthis.channel = await quickp2p.createChannel();\n\t\t\tthis.channel\n\t\t\t\t.on(\"connected\", () => {\n\t\t\t\t\tonSyncer(new MasterSyncer(this.channel));\n\t\t\t\t})\n\t\t\t\t.on(\"disconnected\", onError);\n\t\t\tthis.setState({ token: this.channel.token, isDown: false });\n\t\t} catch (e) {\n\t\t\tthis.setState({ isDown: true });\n\t\t}\n\t}\n\n\t_copyLink = (e) => {\n\t\te.preventDefault();\n\n\t\tnavigator.clipboard.writeText(e.target.href);\n\t\tthis.setState({ copied: true });\n\t\tsetTimeout(() => {\n\t\t\tthis.setState({ copied: false });\n\t\t}, COPIED_MESSAGE_TIME);\n\t};\n}\n","import React, { Component } from \"react\";\r\nimport Header from \"../widgets/Header\";\r\nimport { SlaveSyncer } from \"../networking\";\r\nimport quickp2p from \"quickp2p\";\r\nimport strings from \"../locales\";\r\n\r\nexport default class JoinHeader extends Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Header>\r\n\t\t\t\t<span>{strings.connecting}</span>\r\n\t\t\t</Header>\r\n\t\t);\r\n\t}\r\n\r\n\tasync componentDidMount() {\r\n\t\tconst { onSyncer, onError } = this.props;\r\n\r\n\t\ttry {\r\n\t\t\tconst channel = await quickp2p.joinChannel(this.props.token);\r\n\t\t\tchannel\r\n\t\t\t\t.on(\"connected\", () => {\r\n\t\t\t\t\tonSyncer(new SlaveSyncer(channel));\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"disconnected\", onError);\r\n\t\t} catch (e) {\r\n\t\t\tonError();\r\n\t\t}\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\n\r\nexport default class KeyBinding extends Component {\r\n\trender() {\r\n\t\tconst { displayName, isAssigning, verticalMirror = false } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<button\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tclassName=\"nes-btn is-primary\"\r\n\t\t\t\tonClick={this._onAssign}\r\n\t\t\t>\r\n\t\t\t\t<span\r\n\t\t\t\t\tstyle={\r\n\t\t\t\t\t\tverticalMirror\r\n\t\t\t\t\t\t\t? { transform: \"scale(1, -1)\", display: \"inline-block\" }\r\n\t\t\t\t\t\t\t: null\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t{isAssigning ? \"...\" : displayName}\r\n\t\t\t\t</span>\r\n\t\t\t</button>\r\n\t\t);\r\n\t}\r\n\r\n\t_onAssign = () => {\r\n\t\tif (this.props.isAssigning) this.props.onAssignCancel();\r\n\t\telse this.props.onAssignStart();\r\n\t};\r\n}\r\n","import React, { Component } from \"react\";\r\nimport KeyBinding from \"../widgets/KeyBinding\";\r\nimport bus from \"../events\";\r\nimport config from \"../config\";\r\nimport strings from \"../locales\";\r\nimport styles from \"./Settings.module.css\";\r\nimport classNames from \"classnames\";\r\nimport _ from \"lodash\";\r\n\r\nconst BUTTONS = [\r\n\t{ name: \"BUTTON_LEFT\", displayName: \"<\" },\r\n\t{ name: \"BUTTON_RIGHT\", displayName: \">\" },\r\n\t{ name: \"BUTTON_UP\", displayName: \"v\", verticalMirror: true },\r\n\t{ name: \"BUTTON_DOWN\", displayName: \"v\" },\r\n\t{ name: \"BUTTON_B\", displayName: \"B\" },\r\n\t{ name: \"BUTTON_A\", displayName: \"A\" },\r\n\t{ name: \"BUTTON_SELECT\", displayName: \"SELECT\" },\r\n\t{ name: \"BUTTON_START\", displayName: \"START\" }\r\n];\r\n\r\nexport default class Settings extends Component {\r\n\tstate = { mappingButton: null };\r\n\r\n\tcomponentDidMount() {\r\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDown);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className={styles.settings}>\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\tclassName={classNames(styles.closeButton, \"nes-btn\", \"is-error\")}\r\n\t\t\t\t\tonClick={this._onClose}\r\n\t\t\t\t>\r\n\t\t\t\t\tx\r\n\t\t\t\t</button>\r\n\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\tstyles.setDefaultsButton,\r\n\t\t\t\t\t\t\"nes-btn\",\r\n\t\t\t\t\t\t\"is-warning\"\r\n\t\t\t\t\t)}\r\n\t\t\t\t\tonClick={this._onSetDefaults}\r\n\t\t\t\t>\r\n\t\t\t\t\t{strings.setDefaults}\r\n\t\t\t\t</button>\r\n\r\n\t\t\t\t<section\r\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"title\">{strings.sound}</div>\r\n\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t{config.soundOptions.map((it) => (\r\n\t\t\t\t\t\t\t<label key={it.name}>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\r\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\r\n\t\t\t\t\t\t\t\t\tname=\"sound\"\r\n\t\t\t\t\t\t\t\t\tchecked={config.options.sound === it.name}\r\n\t\t\t\t\t\t\t\t\tonChange={(e) => this._update(\"sound\", it.name)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<span>{it.name}</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t\t<br />\r\n\t\t\t\t<br />\r\n\r\n\t\t\t\t<section\r\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"title\">{strings.buffering}</div>\r\n\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t{config.bufferingOptions.map((it) => (\r\n\t\t\t\t\t\t\t<label key={it.name}>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\r\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\r\n\t\t\t\t\t\t\t\t\tname=\"buffering\"\r\n\t\t\t\t\t\t\t\t\tchecked={config.options.buffering === it.name}\r\n\t\t\t\t\t\t\t\t\tonChange={() => this._update(\"buffering\", it.name)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<span>{it.name}</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t\t<br />\r\n\t\t\t\t<br />\r\n\r\n\t\t\t\t<section\r\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"title\">{strings.crtEffect}</div>\r\n\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t{[true, false].map((it) => (\r\n\t\t\t\t\t\t\t<label key={it}>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\r\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\r\n\t\t\t\t\t\t\t\t\tname=\"crt\"\r\n\t\t\t\t\t\t\t\t\tchecked={config.options.crt === it}\r\n\t\t\t\t\t\t\t\t\tonChange={() => this._update(\"crt\", it)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<span>{strings[`enabled_${it}`]}</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t\t<br />\r\n\t\t\t\t<br />\r\n\r\n\t\t\t\t<section\r\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"title\">{strings.input}</div>\r\n\r\n\t\t\t\t\t{BUTTONS.map((button) => (\r\n\t\t\t\t\t\t<KeyBinding\r\n\t\t\t\t\t\t\tkey={button.name}\r\n\t\t\t\t\t\t\tname={button.name}\r\n\t\t\t\t\t\t\tverticalMirror={button.verticalMirror}\r\n\t\t\t\t\t\t\tdisplayName={button.displayName}\r\n\t\t\t\t\t\t\tisAssigning={this.state.mappingButton === button.name}\r\n\t\t\t\t\t\t\tonAssignStart={() =>\r\n\t\t\t\t\t\t\t\tthis.setState({ mappingButton: button.name })\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tonAssignCancel={() => this.setState({ mappingButton: null })}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t_update(property, value) {\r\n\t\t_.set(config.options, property, value);\r\n\t\tconfig.save();\r\n\t\tthis._notify();\r\n\t}\r\n\r\n\t_notify() {\r\n\t\tbus.emit(\"volume\", config.sound.gain);\r\n\t\tbus.emit(\"keymap\");\r\n\r\n\t\tconst container = document.querySelector(\"#container\");\r\n\t\tif (config.options.crt) container.classList.add(\"crt\");\r\n\t\telse container.classList.remove(\"crt\");\r\n\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\r\n\t_onClose = () => {\r\n\t\tbus.emit(\"closeSettings\");\r\n\t};\r\n\r\n\t_onSetDefaults = () => {\r\n\t\tconfig.reset();\r\n\t\tthis._notify();\r\n\t};\r\n\r\n\t_onAssign = () => {\r\n\t\tif (this.props.isAssigning) return;\r\n\r\n\t\tthis.props.onAssignStart();\r\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\r\n\t};\r\n\r\n\t_onKeyDown = (e) => {\r\n\t\tif (!this.state.mappingButton) return;\r\n\r\n\t\te.preventDefault();\r\n\r\n\t\tconst oldKey = _.findKey(\r\n\t\t\tconfig.options.input,\r\n\t\t\t(it) => it === this.state.mappingButton\r\n\t\t);\r\n\t\tconst newKey = e.key;\r\n\r\n\t\tdelete config.options.input[oldKey];\r\n\t\tconfig.options.input[newKey] = this.state.mappingButton;\r\n\t\tconfig.save();\r\n\t\tthis._notify();\r\n\r\n\t\tthis.setState({ mappingButton: null });\r\n\t};\r\n}\r\n","import React, { Component } from \"react\";\r\nimport Loader from \"react-loader-spinner\";\r\nimport Settings from \"./Settings\";\r\nimport bus from \"../events\";\r\nimport styles from \"./Overlay.module.css\";\r\nimport classNames from \"classnames\";\r\n\r\nexport default class Overlay extends Component {\r\n\tstate = { isSettingsMenuOpen: false, isLoading: false, message: null };\r\n\r\n\trender() {\r\n\t\tconst { isVisible } = this;\r\n\t\tconst { isSettingsMenuOpen, isLoading, message } = this.state;\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classNames(styles.overlay, isVisible && styles.show)}>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={classNames(styles.loader, message == null && styles.dark)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{isSettingsMenuOpen ? (\r\n\t\t\t\t\t\t<Settings />\r\n\t\t\t\t\t) : message != null ? (\r\n\t\t\t\t\t\t<div className={styles.message}>{message}</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\tisLoading && (\r\n\t\t\t\t\t\t\t<Loader type=\"Watch\" color=\"#CCCCCC\" height=\"50\" width=\"50\" />\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tbus\r\n\t\t\t.on(\"isLoading\", (isLoading) => {\r\n\t\t\t\tthis.setState({ isLoading });\r\n\t\t\t})\r\n\t\t\t.on(\"message\", (message) => {\r\n\t\t\t\tthis.setState({ isLoading: false, message });\r\n\t\t\t})\r\n\t\t\t.on(\"openSettings\", () => {\r\n\t\t\t\tthis.setState({ isSettingsMenuOpen: true });\r\n\t\t\t})\r\n\t\t\t.on(\"closeSettings\", () => {\r\n\t\t\t\tthis.setState({ isSettingsMenuOpen: false });\r\n\t\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tbus.removeListener(\"isLoading\");\r\n\t\tbus.removeListener(\"message\");\r\n\t\tbus.removeListener(\"openSettings\");\r\n\t\tbus.removeListener(\"closeSettings\");\r\n\t}\r\n\r\n\tget isVisible() {\r\n\t\treturn (\r\n\t\t\tthis.state.isSettingsMenuOpen ||\r\n\t\t\tthis.state.isLoading ||\r\n\t\t\tthis.state.message != null\r\n\t\t);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\n\r\nconst SCREEN_WIDTH = 256;\r\nconst SCREEN_HEIGHT = 240;\r\n\r\nexport default class TVNoise extends Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<canvas\r\n\t\t\t\tstyle={{ width: \"100%\", height: \"100%\", borderRadius: 8 }}\r\n\t\t\t\twidth={SCREEN_WIDTH}\r\n\t\t\t\theight={SCREEN_HEIGHT}\r\n\t\t\t\tref={(canvas) => {\r\n\t\t\t\t\tif (canvas) this._initCanvas(canvas);\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tcancelAnimationFrame(this._frameId);\r\n\t}\r\n\r\n\t_initCanvas(canvas) {\r\n\t\tconst self = this;\r\n\t\tconst context = canvas.getContext(\"2d\");\r\n\r\n\t\tfunction noise(ctx) {\r\n\t\t\tlet w = ctx.canvas.width,\r\n\t\t\t\th = ctx.canvas.height,\r\n\t\t\t\tidata = ctx.createImageData(w, h),\r\n\t\t\t\tbuffer32 = new Uint32Array(idata.data.buffer),\r\n\t\t\t\tlen = buffer32.length,\r\n\t\t\t\ti = 0;\r\n\r\n\t\t\tfor (; i < len; ) buffer32[i++] = ((255 * Math.random()) | 0) << 24;\r\n\r\n\t\t\tctx.putImageData(idata, 0, 0);\r\n\t\t}\r\n\r\n\t\tlet toggle = true;\r\n\t\t(function loop() {\r\n\t\t\ttoggle = !toggle;\r\n\t\t\tif (toggle) {\r\n\t\t\t\tself._frameId = requestAnimationFrame(loop);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tnoise(context);\r\n\t\t\tself._frameId = requestAnimationFrame(loop);\r\n\t\t})();\r\n\t}\r\n}\r\n","import cleanQueryString from \"./cleanQueryString\";\r\nimport ellipsize from \"./ellipsize\";\r\n\r\nexport default { cleanQueryString, ellipsize };\r\n","export default () => {\r\n\tlet url;\r\n\turl = window.location.href;\r\n\turl = url.replace(url.substring(url.indexOf(\"?\")), \"\");\r\n\turl = url.substring(url.indexOf(\"//\") + 2);\r\n\turl = url.substring(url.indexOf(\"/\"));\r\n\twindow.history.replaceState({}, \"\", url);\r\n};\r\n","export default (string, limit) =>\r\n\t`${string.substring(0, limit)}${string.length > limit ? \"\" : \"\"}`;\r\n","import React, { Component } from \"react\";\nimport config from \"../config\";\nimport strings from \"../locales\";\nimport helpers from \"../gui/helpers\";\nimport bus from \"../events\";\nimport styles from \"./Controls.module.css\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\nconst TRICK_TIME = 100;\nconst FRIENDLY_NAMES = {\n\tArrowLeft: \"<\",\n\tArrowRight: \">\",\n\tArrowUp: \"~v\",\n\tArrowDown: \"v\",\n\t\" \": \"[Space]\"\n};\n\nexport default class Controls extends Component {\n\trender() {\n\t\tconst upKey = this._keyFor(\"BUTTON_UP\");\n\t\tconst isUpArrow = upKey === \"~v\";\n\n\t\treturn (\n\t\t\t<div className={styles.controls} id=\"controls\">\n\t\t\t\t<b className={classNames(styles.title, styles.centered)}>\n\t\t\t\t\t{strings.controls}\n\t\t\t\t</b>\n\t\t\t\t<br />\n\t\t\t\t{this.usesGamepad ? (\n\t\t\t\t\t<div className={styles.centered}>{strings.yourXboxController}</div>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<div className={styles.controller}>\n\t\t\t\t\t\t\t<span className={styles.dpad}>\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_LEFT\")}</span>{\" \"}\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_RIGHT\")}</span>{\" \"}\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tstyle={\n\t\t\t\t\t\t\t\t\t\tisUpArrow\n\t\t\t\t\t\t\t\t\t\t\t? { transform: \"scale(1, -1)\", display: \"inline-block\" }\n\t\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isUpArrow ? \"v\" : upKey}\n\t\t\t\t\t\t\t\t</span>{\" \"}\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_DOWN\")}</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span className={styles.buttons}>\n\t\t\t\t\t\t\t\t{this._keyFor(\"BUTTON_B\")} {this._keyFor(\"BUTTON_A\")}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className={styles.centered}>\n\t\t\t\t\t\t\t{this._keyFor(\"BUTTON_SELECT\")} {this._keyFor(\"BUTTON_START\")}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tbus.on(\"keymap\", () => {\n\t\t\tbus.emit(\"keymap-updated\");\n\t\t\tthis.forceUpdate();\n\n\t\t\tconst element = document.querySelector(\"#controls\");\n\t\t\telement.classList.remove(\"blink\");\n\t\t\tsetTimeout(() => element.classList.add(\"blink\"), TRICK_TIME);\n\t\t});\n\n\t\twindow.addEventListener(\"gamepadconnected\", this._onGamepadConnected);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tbus.removeListener(\"keymap\");\n\t\twindow.removeEventListener(\"gamepadconnected\");\n\t}\n\n\t_onGamepadConnected = (e) => {\n\t\tif (e.gamepad.mapping !== \"standard\") return;\n\n\t\tthis.usesGamepad = true;\n\t\tthis.forceUpdate();\n\t};\n\n\t_keyFor(button) {\n\t\tconst key = _.findKey(config.options.input, (it) => it === button);\n\t\tif (!key) return \"[?]\";\n\n\t\treturn this._format(key);\n\t}\n\n\t_format(key) {\n\t\treturn (\n\t\t\tFRIENDLY_NAMES[key] ||\n\t\t\t(key.length === 1 ? key.toUpperCase() : `[${helpers.ellipsize(key, 6)}]`)\n\t\t);\n\t}\n}\n","import React, { Component } from \"react\";\r\nimport bus from \"../events\";\r\nimport styles from \"./SettingsButton.module.css\";\r\nimport strings from \"../locales\";\r\n\r\nexport default class SettingsButton extends Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className={styles.button}>\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\ttabIndex=\"-1\"\r\n\t\t\t\t\tclassName=\"nes-btn\"\r\n\t\t\t\t\tonClick={this._onClick}\r\n\t\t\t\t>\r\n\t\t\t\t\t{strings.settings}\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t_onClick = () => {\r\n\t\tbus.emit(\"openSettings\");\r\n\t};\r\n}\r\n","import React, { Component } from \"react\";\r\nimport Emulator from \"../emulator\";\r\nimport InviteHeader from \"./InviteHeader\";\r\nimport JoinHeader from \"./JoinHeader\";\r\nimport Overlay from \"./Overlay\";\r\nimport Header from \"../widgets/Header\";\r\nimport TVNoise from \"../widgets/TVNoise\";\r\nimport Controls from \"../widgets/Controls\";\r\nimport SettingsButton from \"../widgets/SettingsButton\";\r\nimport helpers from \"./helpers\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport styles from \"./PlayScreen.module.css\";\r\nimport strings from \"../locales\";\r\nimport classNames from \"classnames\";\r\nimport _ from \"lodash\";\r\n\r\n// DEBUG\r\nwindow.bus = require(\"../events\").default;\r\nwindow.config = require(\"../config\").default;\r\n\r\nexport default class PlayScreen extends Component {\r\n\tstate = { rom: null, syncer: null };\r\n\r\n\trender() {\r\n\t\tconst { token } = this.props;\r\n\t\tconst { rom, syncer } = this.state;\r\n\r\n\t\treturn (\r\n\t\t\t<div className={styles.app}>\r\n\t\t\t\t{syncer ? (\r\n\t\t\t\t\t<Header>{strings.connected}</Header>\r\n\t\t\t\t) : token ? (\r\n\t\t\t\t\t<JoinHeader\r\n\t\t\t\t\t\tonSyncer={this._onSyncer}\r\n\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t/>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<InviteHeader\r\n\t\t\t\t\t\tonSyncer={this._onSyncer}\r\n\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\tneedsRom={!rom}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{\r\n\t\t\t\t\t<div className={styles.main}>\r\n\t\t\t\t\t\t<section\r\n\t\t\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\t\t\tstyles.gameContainer,\r\n\t\t\t\t\t\t\t\t\"nes-container\",\r\n\t\t\t\t\t\t\t\t\"is-dark\",\r\n\t\t\t\t\t\t\t\t\"with-title\"\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div className={styles.overlay}>\r\n\t\t\t\t\t\t\t\t<Overlay />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{rom ? (\r\n\t\t\t\t\t\t\t\t<Emulator\r\n\t\t\t\t\t\t\t\t\trom={rom}\r\n\t\t\t\t\t\t\t\t\tsyncer={syncer}\r\n\t\t\t\t\t\t\t\t\tonStartPressed={this._onStartPressed}\r\n\t\t\t\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\t\t\t\tref={(ref) => (this.emulator = ref)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<TVNoise />\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\r\n\t\t\t\t<div className={styles.controls}>\r\n\t\t\t\t\t<Controls />\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className={styles.menu}>\r\n\t\t\t\t\t<SettingsButton />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\twindow.addEventListener(\"dragover\", this._ignore);\r\n\t\twindow.addEventListener(\"dragenter\", this._ignore);\r\n\t\twindow.addEventListener(\"drop\", this._onFileDrop);\r\n\t\tif (config.options.crt)\r\n\t\t\tdocument.querySelector(\"#container\").classList.add(\"crt\");\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener(\"dragover\", this._ignore);\r\n\t\twindow.removeEventListener(\"dragenter\", this._ignore);\r\n\t\twindow.removeEventListener(\"drop\", this._onFileDrop);\r\n\t}\r\n\r\n\t_onSyncer = (syncer) => {\r\n\t\tthis.setState({ syncer });\r\n\r\n\t\tsyncer.on(\"rom\", (rom) => {\r\n\t\t\tthis._loadRom(rom, () => syncer.initializeEmulator(this.emulator), false);\r\n\t\t});\r\n\t\tsyncer.on(\"start\", () => this.emulator && this.emulator.start());\r\n\r\n\t\tsyncer.initializeRom(this.state.rom);\r\n\t};\r\n\r\n\t_loadRom(rom, callback = _.noop, start = true) {\r\n\t\tbus.emit(\"message\", null);\r\n\r\n\t\tthis.setState({ rom }, () => {\r\n\t\t\tcallback();\r\n\t\t\tif (start) this.emulator.start();\r\n\t\t});\r\n\t}\r\n\r\n\t_onFileDrop = (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst file = _.first(e.dataTransfer.files);\r\n\t\tconst reader = new FileReader();\r\n\t\tif (!file) return;\r\n\r\n\t\treader.onload = (event) => {\r\n\t\t\tconst rom = event.target.result;\r\n\r\n\t\t\tif (this.state.syncer) this.state.syncer.updateRom(rom);\r\n\t\t\telse this._loadRom(event.target.result);\r\n\t\t};\r\n\r\n\t\treader.readAsArrayBuffer(file);\r\n\t};\r\n\r\n\t_ignore = (e) => {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\t};\r\n\r\n\t_onStartPressed = () => {\r\n\t\tif (!this.state.syncer) return;\r\n\t\tthis.state.syncer.onStartPressed();\r\n\t};\r\n\r\n\t_onError = (error, reset = true) => {\r\n\t\tthis.setState({ rom: null });\r\n\t\tbus.emit(\"message\", error || strings.errors.connectionFailed);\r\n\t\tif (!reset) return;\r\n\r\n\t\tthis.setState({ syncer: null });\r\n\t\thelpers.cleanQueryString();\r\n\t\twindow.location.href = \"#/\";\r\n\t};\r\n}\r\n","import React, { PureComponent } from \"react\";\r\nimport PlayScreen from \"./gui/PlayScreen\";\r\nimport querystring from \"query-string\";\r\nimport quickp2p, { SimpleStore } from \"quickp2p\";\r\n\r\nquickp2p.setStore(\r\n\tnew SimpleStore(\"https://simple-key-value-store.herokuapp.com\")\r\n);\r\n\r\nexport default class App extends PureComponent {\r\n\trender() {\r\n\t\tconst route = window.location.hash;\r\n\r\n\t\tif (route.startsWith(\"#/join\"))\r\n\t\t\treturn <PlayScreen token={this.inviteToken} />;\r\n\t\telse return <PlayScreen />;\r\n\t}\r\n\r\n\tcomponentWillMount() {\r\n\t\tthis._listener = window.addEventListener(\"hashchange\", (e) => {\r\n\t\t\tthis.forceUpdate();\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener(\"hashchange\", this._listener);\r\n\t}\r\n\r\n\tget inviteToken() {\r\n\t\treturn querystring.parse(window.location.search).token;\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport \"nes.css/css/nes.css\";\r\nimport \"./index.css\";\r\nimport \"./crt.css\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"controls\":\"Controls_controls__2Z41f\",\"title\":\"Controls_title__kk3Y5\",\"controller\":\"Controls_controller__35wyc\",\"dpad\":\"Controls_dpad__XQjat\",\"buttons\":\"Controls_buttons__x_aTK\",\"centered\":\"Controls_centered__3mb8d\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"PlayScreen_app__19HdR\",\"main\":\"PlayScreen_main__2DZfL\",\"gameContainer\":\"PlayScreen_gameContainer__TNJBD\",\"overlay\":\"PlayScreen_overlay__1M2gy\",\"controls\":\"PlayScreen_controls__1Ryre\",\"menu\":\"PlayScreen_menu__1iXjj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"overlay\":\"Overlay_overlay__2xHdf\",\"show\":\"Overlay_show__CYhNa\",\"loader\":\"Overlay_loader__3Disu\",\"dark\":\"Overlay_dark__2IwIj\",\"message\":\"Overlay_message__3zFor\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"settings\":\"Settings_settings__3IKOb\",\"closeButton\":\"Settings_closeButton__1E0A8\",\"setDefaultsButton\":\"Settings_setDefaultsButton__n5JDJ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"balloon\":\"BalloonMessage_balloon__3lI4z\",\"character\":\"BalloonMessage_character__1zLP6\"};","import EventEmitter from \"eventemitter3\";\r\n\r\nexport default new EventEmitter();\r\n","import bus from \"./bus\";\r\n\r\nexport default bus;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"screen\":\"Screen_screen__2lJdo\"};","module.exports = __webpack_public_path__ + \"static/media/halu.2e5e0dc3.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"SettingsButton_button__3xnE0\"};","const KEY = \"options\";\r\nconst HALF_VOLUME = \"50%\";\r\nconst DISABLED = \"Disabled\";\r\n\r\nclass Config {\r\n\tconstructor() {\r\n\t\tthis.options = this.defaultOptions;\r\n\t\tthis.load();\r\n\t}\r\n\r\n\tsave() {\r\n\t\tlocalStorage.setItem(KEY, JSON.stringify(this.options));\r\n\t}\r\n\r\n\tload() {\r\n\t\ttry {\r\n\t\t\tthis.options =\r\n\t\t\t\tJSON.parse(localStorage.getItem(KEY)) || this.defaultOptions;\r\n\t\t} catch (e) {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t}\r\n\r\n\treset() {\r\n\t\tthis.options = this.defaultOptions;\r\n\t\tthis.save();\r\n\t}\r\n\r\n\tget sound() {\r\n\t\treturn this.soundOptions.find((it) => it.name === this.options.sound);\r\n\t}\r\n\r\n\tget buffering() {\r\n\t\treturn this.bufferingOptions.find(\r\n\t\t\t(it) => it.name === this.options.buffering\r\n\t\t);\r\n\t}\r\n\r\n\tget defaultOptions() {\r\n\t\treturn {\r\n\t\t\tsound: HALF_VOLUME,\r\n\t\t\tbuffering: DISABLED,\r\n\t\t\tcrt: true,\r\n\t\t\tinput: {\r\n\t\t\t\t\" \": \"BUTTON_A\",\r\n\t\t\t\td: \"BUTTON_B\",\r\n\t\t\t\tDelete: \"BUTTON_SELECT\",\r\n\t\t\t\tEnter: \"BUTTON_START\",\r\n\t\t\t\tArrowUp: \"BUTTON_UP\",\r\n\t\t\t\tArrowDown: \"BUTTON_DOWN\",\r\n\t\t\t\tArrowLeft: \"BUTTON_LEFT\",\r\n\t\t\t\tArrowRight: \"BUTTON_RIGHT\"\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tget soundOptions() {\r\n\t\treturn [\r\n\t\t\t{ name: \"100%\", gain: 1 },\r\n\t\t\t{ name: \"90%\", gain: 0.9 },\r\n\t\t\t{ name: \"75%\", gain: 0.75 },\r\n\t\t\t{ name: HALF_VOLUME, gain: 0.5 },\r\n\t\t\t{ name: \"25%\", gain: 0.25 },\r\n\t\t\t{ name: \"10%\", gain: 0.1 },\r\n\t\t\t{ name: \"0%\", gain: 0 }\r\n\t\t];\r\n\t}\r\n\r\n\tget bufferingOptions() {\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tname: DISABLED,\r\n\t\t\t\tmasterBufferLimit: 3,\r\n\t\t\t\tminBufferSize: 1,\r\n\t\t\t\tmaxBufferSize: 1\r\n\t\t\t},\r\n\t\t\t{ name: \"Low\", masterBufferLimit: 3, minBufferSize: 1, maxBufferSize: 2 },\r\n\t\t\t{\r\n\t\t\t\tname: \"Medium\",\r\n\t\t\t\tmasterBufferLimit: 5,\r\n\t\t\t\tminBufferSize: 2,\r\n\t\t\t\tmaxBufferSize: 3\r\n\t\t\t},\r\n\t\t\t{ name: \"High\", masterBufferLimit: 5, minBufferSize: 3, maxBufferSize: 5 }\r\n\t\t];\r\n\t}\r\n}\r\n\r\nexport default new Config();\r\n"],"sourceRoot":""}